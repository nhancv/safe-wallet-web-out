(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9331],{466:()=>{},2347:(e,t,r)=>{let a=r(84923);e.exports=(e,t)=>e.sort((e,r)=>a(e,r,t))},3074:(e,t,r)=>{let a=r(27148),n=r(98033);e.exports=(e,t,r)=>{let i=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!i||-1===s.compare(e))&&(s=new a(i=e,r))}),i}},4977:(e,t,r)=>{let a=r(24373),n=r(18505),i=r(38224),s=r(53987),o=r(34855),c=r(73002);e.exports=(e,t,r,l)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e===r;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof r&&(r=r.version),e!==r;case"":case"=":case"==":return a(e,r,l);case"!=":return n(e,r,l);case">":return i(e,r,l);case">=":return s(e,r,l);case"<":return o(e,r,l);case"<=":return c(e,r,l);default:throw TypeError(`Invalid operator: ${t}`)}}},8195:(e,t,r)=>{let a=r(27148);e.exports=(e,t)=>new a(e,t).patch},8743:()=>{},9331:(e,t,r)=>{"use strict";r.d(t,{SignerEthBuilder:()=>a.SignerEthBuilder}),r(9180);var a=r(73705)},11139:(e,t,r)=>{let a=r(84923);e.exports=(e,t)=>e.sort((e,r)=>a(r,e,t))},13169:(e,t,r)=>{let a=r(46006);e.exports=(e,t)=>a(e,t,!0)},15076:(e,t,r)=>{let a=Symbol("SemVer ANY");class n{static get ANY(){return a}constructor(e,t){if(t=i(t),e instanceof n){if(!!t.loose===e.loose)return e;e=e.value}l("comparator",e=e.trim().split(/\s+/).join(" "),t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===a?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(e){let t=this.options.loose?s[o.COMPARATORLOOSE]:s[o.COMPARATOR],r=e.match(t);if(!r)throw TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==r[1]?r[1]:"","="===this.operator&&(this.operator=""),r[2]?this.semver=new d(r[2],this.options.loose):this.semver=a}toString(){return this.value}test(e){if(l("Comparator.test",e,this.options.loose),this.semver===a||e===a)return!0;if("string"==typeof e)try{e=new d(e,this.options)}catch(e){return!1}return c(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw TypeError("a Comparator is required");return""===this.operator?""===this.value||new u(e.value,t).test(this.value):""===e.operator?""===e.value||new u(this.value,t).test(e.semver):!((t=i(t)).includePrerelease&&("<0.0.0-0"===this.value||"<0.0.0-0"===e.value)||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||c(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||c(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">"))}}e.exports=n;let i=r(81919),{safeRe:s,t:o}=r(86712),c=r(4977),l=r(69856),d=r(27148),u=r(98033)},17931:(e,t,r)=>{let a=r(57311);e.exports=(e,t,r)=>a(e,t,">",r)},18505:(e,t,r)=>{let a=r(46006);e.exports=(e,t,r)=>0!==a(e,t,r)},20204:()=>{},22784:()=>{},23882:(e,t,r)=>{let a=r(98033),n=r(15076),{ANY:i}=n,s=r(91524),o=r(46006),c=[new n(">=0.0.0-0")],l=[new n(">=0.0.0")],d=(e,t,r)=>{let a,n,d,h,f,g,m;if(e===t)return!0;if(1===e.length&&e[0].semver===i){if(1===t.length&&t[0].semver===i)return!0;e=r.includePrerelease?c:l}if(1===t.length&&t[0].semver===i){if(r.includePrerelease)return!0;t=l}let y=new Set;for(let t of e)">"===t.operator||">="===t.operator?a=u(a,t,r):"<"===t.operator||"<="===t.operator?n=p(n,t,r):y.add(t.semver);if(y.size>1||a&&n&&((d=o(a.semver,n.semver,r))>0||0===d&&(">="!==a.operator||"<="!==n.operator)))return null;for(let e of y){if(a&&!s(e,String(a),r)||n&&!s(e,String(n),r))return null;for(let a of t)if(!s(e,String(a),r))return!1;return!0}let E=!!n&&!r.includePrerelease&&!!n.semver.prerelease.length&&n.semver,C=!!a&&!r.includePrerelease&&!!a.semver.prerelease.length&&a.semver;for(let e of(E&&1===E.prerelease.length&&"<"===n.operator&&0===E.prerelease[0]&&(E=!1),t)){if(m=m||">"===e.operator||">="===e.operator,g=g||"<"===e.operator||"<="===e.operator,a){if(C&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===C.major&&e.semver.minor===C.minor&&e.semver.patch===C.patch&&(C=!1),">"===e.operator||">="===e.operator){if((h=u(a,e,r))===e&&h!==a)return!1}else if(">="===a.operator&&!s(a.semver,String(e),r))return!1}if(n){if(E&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===E.major&&e.semver.minor===E.minor&&e.semver.patch===E.patch&&(E=!1),"<"===e.operator||"<="===e.operator){if((f=p(n,e,r))===e&&f!==n)return!1}else if("<="===n.operator&&!s(n.semver,String(e),r))return!1}if(!e.operator&&(n||a)&&0!==d)return!1}return(!a||!g||!!n||0===d)&&(!n||!m||!!a||0===d)&&!C&&!E&&!0},u=(e,t,r)=>{if(!e)return t;let a=o(e.semver,t.semver,r);return a>0?e:a<0?t:">"===t.operator&&">="===e.operator?t:e},p=(e,t,r)=>{if(!e)return t;let a=o(e.semver,t.semver,r);return a<0?e:a>0?t:"<"===t.operator&&"<="===e.operator?t:e};e.exports=(e,t,r={})=>{if(e===t)return!0;e=new a(e,r),t=new a(t,r);let n=!1;e:for(let a of e.set){for(let e of t.set){let t=d(a,e,r);if(n=n||null!==t,t)continue e}if(n)return!1}return!0}},24373:(e,t,r)=>{let a=r(46006);e.exports=(e,t,r)=>0===a(e,t,r)},24757:(e,t,r)=>{let a=r(27148),n=r(98033),i=r(38224);e.exports=(e,t)=>{e=new n(e,t);let r=new a("0.0.0");if(e.test(r)||(r=new a("0.0.0-0"),e.test(r)))return r;r=null;for(let t=0;t<e.set.length;++t){let n=e.set[t],s=null;n.forEach(e=>{let t=new a(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":(!s||i(t,s))&&(s=t);break;case"<":case"<=":break;default:throw Error(`Unexpected operation: ${e.operator}`)}}),s&&(!r||i(r,s))&&(r=s)}return r&&e.test(r)?r:null}},26087:e=>{let t=/^[0-9]+$/,r=(e,r)=>{let a=t.test(e),n=t.test(r);return a&&n&&(e*=1,r*=1),e===r?0:a&&!n?-1:n&&!a?1:e<r?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:(e,t)=>r(t,e)}},27148:(e,t,r)=>{let a=r(69856),{MAX_LENGTH:n,MAX_SAFE_INTEGER:i}=r(38538),{safeRe:s,t:o}=r(86712),c=r(81919),{compareIdentifiers:l}=r(26087);class d{constructor(e,t){if(t=c(t),e instanceof d){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>n)throw TypeError(`version is longer than ${n} characters`);a("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?s[o.LOOSE]:s[o.FULL]);if(!r)throw TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>i||this.major<0)throw TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){let t=+e;if(t>=0&&t<i)return t}return e}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(a("SemVer.compare",this.version,this.options,e),!(e instanceof d)){if("string"==typeof e&&e===this.version)return 0;e=new d(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof d||(e=new d(e,this.options)),l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(e instanceof d||(e=new d(e,this.options)),this.prerelease.length&&!e.prerelease.length)return -1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],n=e.prerelease[t];if(a("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return l(r,n)}while(++t)}compareBuild(e){e instanceof d||(e=new d(e,this.options));let t=0;do{let r=this.build[t],n=e.build[t];if(a("build compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return -1;else if(r===n)continue;else return l(r,n)}while(++t)}inc(e,t,r){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"major":(0!==this.minor||0!==this.patch||0===this.prerelease.length)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(0!==this.patch||0===this.prerelease.length)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{let e=+!!Number(r);if(!t&&!1===r)throw Error("invalid increment argument: identifier is empty");if(0===this.prerelease.length)this.prerelease=[e];else{let a=this.prerelease.length;for(;--a>=0;)"number"==typeof this.prerelease[a]&&(this.prerelease[a]++,a=-2);if(-1===a){if(t===this.prerelease.join(".")&&!1===r)throw Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let a=[t,e];!1===r&&(a=[t]),0===l(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}e.exports=d},27224:e=>{class t{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(void 0!==t)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){let e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}}e.exports=t},29304:function(e,t,r){var a,n,i,s,o,c,l,d,u,p;a=r(35596),n=Math,s=(i=a.lib).WordArray,o=i.Hasher,c=a.algo,l=[],d=[],function(){function e(e){return(e-(0|e))*0x100000000|0}for(var t=2,r=0;r<64;)(function(e){for(var t=n.sqrt(e),r=2;r<=t;r++)if(!(e%r))return!1;return!0})(t)&&(r<8&&(l[r]=e(n.pow(t,.5))),d[r]=e(n.pow(t,1/3)),r++),t++}(),u=[],p=c.SHA256=o.extend({_doReset:function(){this._hash=new s.init(l.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,a=r[0],n=r[1],i=r[2],s=r[3],o=r[4],c=r[5],l=r[6],p=r[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=u[h-2],y=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[h]=g+u[h-7]+y+u[h-16]}var E=o&c^~o&l,C=a&n^a&i^n&i,S=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),I=p+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+E+d[h]+u[h],T=S+C;p=l,l=c,c=o,o=s+I|0,s=i,i=n,n=a,a=I+T|0}r[0]=r[0]+a|0,r[1]=r[1]+n|0,r[2]=r[2]+i|0,r[3]=r[3]+s|0,r[4]=r[4]+o|0,r[5]=r[5]+c|0,r[6]=r[6]+l|0,r[7]=r[7]+p|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[(a+64>>>9<<4)+14]=n.floor(r/0x100000000),t[(a+64>>>9<<4)+15]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),a.SHA256=o._createHelper(p),a.HmacSHA256=o._createHmacHelper(p),e.exports=a.SHA256},34855:(e,t,r)=>{let a=r(46006);e.exports=(e,t,r)=>0>a(e,t,r)},35596:function(e,t,r){var a;e.exports=a||function(e,t){if("undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(a=globalThis.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&void 0!==r.g&&r.g.crypto&&(a=r.g.crypto),!a)try{a=r(25156)}catch(e){}var a,n=function(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),s={},o=s.lib={},c=o.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=o.WordArray=c.extend({init:function(e,r){e=this.words=e||[],t!=r?this.sigBytes=r:this.sigBytes=4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,a=this.sigBytes,n=e.sigBytes;if(this.clamp(),a%4)for(var i=0;i<n;i++){var s=r[i>>>2]>>>24-i%4*8&255;t[a+i>>>2]|=s<<24-(a+i)%4*8}else for(var o=0;o<n;o+=4)t[a+o>>>2]=r[o>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=0xffffffff<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new l.init(t,e)}}),d=s.enc={},u=d.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;a.push((i>>>4).toString(16)),a.push((15&i).toString(16))}return a.join("")},parse:function(e){for(var t=e.length,r=[],a=0;a<t;a+=2)r[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new l.init(r,t/2)}},p=d.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;a.push(String.fromCharCode(i))}return a.join("")},parse:function(e){for(var t=e.length,r=[],a=0;a<t;a++)r[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new l.init(r,t)}},h=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,a=this._data,n=a.words,i=a.sigBytes,s=this.blockSize,o=i/(4*s),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,d=e.min(4*c,i);if(c){for(var u=0;u<c;u+=s)this._doProcessBlock(n,u);r=n.splice(0,c),a.sigBytes-=d}return new l.init(r,d)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=f.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}});var g=s.algo={};return s}(Math)},37096:()=>{},38058:()=>{},38224:(e,t,r)=>{let a=r(46006);e.exports=(e,t,r)=>a(e,t,r)>0},38538:e=>{e.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||0x1fffffffffffff,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}},39555:(e,t,r)=>{let a=r(86712),n=r(38538),i=r(27148),s=r(26087),o=r(91678),c=r(94955),l=r(69608),d=r(49313),u=r(41292),p=r(51940),h=r(72968),f=r(8195),g=r(58401),m=r(46006),y=r(99406),E=r(13169),C=r(84923),S=r(2347),I=r(11139),T=r(38224),v=r(34855),A=r(24373),_=r(18505),x=r(53987),R=r(73002),w=r(4977),b=r(61362),D=r(15076),N=r(98033),P=r(91524),O=r(61049),L=r(3074),k=r(45556),F=r(24757),M=r(66438),$=r(57311),U=r(17931),B=r(45586),V=r(41266);e.exports={parse:o,valid:c,clean:l,inc:d,diff:u,major:p,minor:h,patch:f,prerelease:g,compare:m,rcompare:y,compareLoose:E,compareBuild:C,sort:S,rsort:I,gt:T,lt:v,eq:A,neq:_,gte:x,lte:R,cmp:w,coerce:b,Comparator:D,Range:N,satisfies:P,toComparators:O,maxSatisfying:L,minSatisfying:k,minVersion:F,validRange:M,outside:$,gtr:U,ltr:B,intersects:V,simplifyRange:r(52063),subset:r(23882),SemVer:i,re:a.re,src:a.src,tokens:a.t,SEMVER_SPEC_VERSION:n.SEMVER_SPEC_VERSION,RELEASE_TYPES:n.RELEASE_TYPES,compareIdentifiers:s.compareIdentifiers,rcompareIdentifiers:s.rcompareIdentifiers}},41266:(e,t,r)=>{let a=r(98033);e.exports=(e,t,r)=>(e=new a(e,r),t=new a(t,r),e.intersects(t,r))},41292:(e,t,r)=>{let a=r(91678);e.exports=(e,t)=>{let r=a(e,null,!0),n=a(t,null,!0),i=r.compare(n);if(0===i)return null;let s=i>0,o=s?r:n,c=s?n:r,l=!!o.prerelease.length;if(c.prerelease.length&&!l)return c.patch||c.minor?o.patch?"patch":o.minor?"minor":"major":"major";let d=l?"pre":"";return r.major!==n.major?d+"major":r.minor!==n.minor?d+"minor":r.patch!==n.patch?d+"patch":"prerelease"}},45556:(e,t,r)=>{let a=r(27148),n=r(98033);e.exports=(e,t,r)=>{let i=null,s=null,o=null;try{o=new n(t,r)}catch(e){return null}return e.forEach(e=>{o.test(e)&&(!i||1===s.compare(e))&&(s=new a(i=e,r))}),i}},45586:(e,t,r)=>{let a=r(57311);e.exports=(e,t,r)=>a(e,t,"<",r)},46006:(e,t,r)=>{let a=r(27148);e.exports=(e,t,r)=>new a(e,r).compare(new a(t,r))},49313:(e,t,r)=>{let a=r(27148);e.exports=(e,t,r,n,i)=>{"string"==typeof r&&(i=n,n=r,r=void 0);try{return new a(e instanceof a?e.version:e,r).inc(t,n,i).version}catch(e){return null}}},51940:(e,t,r)=>{let a=r(27148);e.exports=(e,t)=>new a(e,t).major},52063:(e,t,r)=>{let a=r(91524),n=r(46006);e.exports=(e,t,r)=>{let i=[],s=null,o=null,c=e.sort((e,t)=>n(e,t,r));for(let e of c)a(e,t,r)?(o=e,s||(s=e)):(o&&i.push([s,o]),o=null,s=null);s&&i.push([s,null]);let l=[];for(let[e,t]of i)e===t?l.push(e):t||e!==c[0]?t?e===c[0]?l.push(`<=${t}`):l.push(`${e} - ${t}`):l.push(`>=${e}`):l.push("*");let d=l.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return d.length<u.length?d:t}},53987:(e,t,r)=>{let a=r(46006);e.exports=(e,t,r)=>a(e,t,r)>=0},54050:()=>{},57311:(e,t,r)=>{let a=r(27148),n=r(15076),{ANY:i}=n,s=r(98033),o=r(91524),c=r(38224),l=r(34855),d=r(73002),u=r(53987);e.exports=(e,t,r,p)=>{let h,f,g,m,y;switch(e=new a(e,p),t=new s(t,p),r){case">":h=c,f=d,g=l,m=">",y=">=";break;case"<":h=l,f=u,g=c,m="<",y="<=";break;default:throw TypeError('Must provide a hilo val of "<" or ">"')}if(o(e,t,p))return!1;for(let r=0;r<t.set.length;++r){let a=t.set[r],s=null,o=null;if(a.forEach(e=>{e.semver===i&&(e=new n(">=0.0.0")),s=s||e,o=o||e,h(e.semver,s.semver,p)?s=e:g(e.semver,o.semver,p)&&(o=e)}),s.operator===m||s.operator===y||(!o.operator||o.operator===m)&&f(e,o.semver)||o.operator===y&&g(e,o.semver))return!1}return!0}},58401:(e,t,r)=>{let a=r(91678);e.exports=(e,t)=>{let r=a(e,t);return r&&r.prerelease.length?r.prerelease:null}},61049:(e,t,r)=>{let a=r(98033);e.exports=(e,t)=>new a(e,t).set.map(e=>e.map(e=>e.value).join(" ").trim().split(" "))},61362:(e,t,r)=>{let a=r(27148),n=r(91678),{safeRe:i,t:s}=r(86712);e.exports=(e,t)=>{if(e instanceof a)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let r=null;if((t=t||{}).rtl){let a;let n=t.includePrerelease?i[s.COERCERTLFULL]:i[s.COERCERTL];for(;(a=n.exec(e))&&(!r||r.index+r[0].length!==e.length);)r&&a.index+a[0].length===r.index+r[0].length||(r=a),n.lastIndex=a.index+a[1].length+a[2].length;n.lastIndex=-1}else r=e.match(t.includePrerelease?i[s.COERCEFULL]:i[s.COERCE]);if(null===r)return null;let o=r[2],c=r[3]||"0",l=r[4]||"0",d=t.includePrerelease&&r[5]?`-${r[5]}`:"",u=t.includePrerelease&&r[6]?`+${r[6]}`:"";return n(`${o}.${c}.${l}${d}${u}`,t)}},66438:(e,t,r)=>{let a=r(98033);e.exports=(e,t)=>{try{return new a(e,t).range||"*"}catch(e){return null}}},68065:()=>{},69608:(e,t,r)=>{let a=r(91678);e.exports=(e,t)=>{let r=a(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null}},69812:()=>{},69856:(e,t,r)=>{var a=r(29143);e.exports="object"==typeof a&&a.env&&a.env.NODE_DEBUG&&/\bsemver\b/i.test(a.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}},70204:()=>{},72968:(e,t,r)=>{let a=r(27148);e.exports=(e,t)=>new a(e,t).minor},73002:(e,t,r)=>{let a=r(46006);e.exports=(e,t,r)=>0>=a(e,t,r)},73705:(e,t,r)=>{"use strict";let a,n,i,s,o,c,l,d,u,p,h,f,g,m,y,E;r.d(t,{SignerEthBuilder:()=>r7}),r(37096);var C=(e=>(e.OPEN_APP="signer.eth.steps.openApp",e.GET_APP_CONFIG="signer.eth.steps.getAppConfig",e.WEB3_CHECKS_OPT_IN="signer.eth.steps.web3ChecksOptIn",e.BUILD_CONTEXT="signer.eth.steps.buildContext",e.PROVIDE_CONTEXT="signer.eth.steps.provideContext",e.PROVIDE_GENERIC_CONTEXT="signer.eth.steps.provideGenericContext",e.SIGN_TRANSACTION="signer.eth.steps.signTransaction",e))(C||{}),S=(e=>(e.OPEN_APP="signer.eth.steps.openApp",e.GET_APP_CONFIG="signer.eth.steps.getAppConfig",e.WEB3_CHECKS_OPT_IN="signer.eth.steps.web3ChecksOptIn",e.BUILD_CONTEXT="signer.eth.steps.buildContext",e.PROVIDE_CONTEXT="signer.eth.steps.provideContext",e.PROVIDE_GENERIC_CONTEXT="signer.eth.steps.provideGenericContext",e.SIGN_TYPED_DATA="signer.eth.steps.signTypedData",e.SIGN_TYPED_DATA_LEGACY="signer.eth.steps.signTypedDataLegacy",e))(S||{});r(466),r(22784),r(69812),r(75163);var I=(e=>(e[e.LEGACY=0]="LEGACY",e[e.EIP2930=1]="EIP2930",e[e.EIP1559=2]="EIP1559",e[e.EIP4844=3]="EIP4844",e))(I||{});r(99201),r(68065),r(9180),r(88762),r(8743);let T={TransactionDataSource:Symbol.for("TransactionDataSource"),TransactionContextLoader:Symbol.for("TransactionContextLoader")},v={TrustedNameDataSource:Symbol.for("TrustedNameDataSource"),TrustedNameContextLoader:Symbol.for("TrustedNameContextLoader")},A={ExternalPluginDataSource:Symbol.for("externalPluginDataSource"),ExternalPluginContextLoader:Symbol.for("externalPluginContextLoader")},_={NftDataSource:Symbol.for("nftDataSource"),NftContextLoader:Symbol.for("nftContextLoader")};var x=(e=>(e.TOKEN="token",e.NFT="nft",e.TRUSTED_NAME="trustedName",e.PLUGIN="plugin",e.EXTERNAL_PLUGIN="externalPlugin",e.TRANSACTION_INFO="transactionInfo",e.ENUM="enum",e.TRANSACTION_FIELD_DESCRIPTION="transactionFieldDescription",e.WEB3_CHECK="web3Check",e.ERROR="error",e))(x||{});let R={TokenDataSource:Symbol.for("TokenDataSource"),TokenContextLoader:Symbol.for("TokenContextLoader")},w={TypedDataDataSource:Symbol.for("TypedDataDataSource"),TypedDataContextLoader:Symbol.for("TypedDataContextLoader")},b={AbiDecoderDataSource:Symbol.for("AbiDecoderDataSource"),CommandDecoderDataSource:Symbol.for("CommandDecoderDataSource"),UniswapContextLoader:Symbol.for("UniswapContextLoader")},D={Web3CheckDataSource:Symbol.for("Web3CheckDataSource"),Web3CheckContextLoader:Symbol.for("Web3CheckContextLoader")};var N=r(15723);let P={Config:Symbol.for("config")},O=e=>new N.i0((t,r,a,n)=>{t(P.Config).toConstantValue(e)});var L=r(75119),k=r(26684);let F={rE:"1.3.1"};var M=Object.defineProperty,$=Object.getOwnPropertyDescriptor;let U=class{constructor(e){this.config=e}async getDappInfos({chainId:e,address:t,selector:r}){try{let a=await L.A.request({method:"GET",url:`${this.config.cal.url}/dapps`,params:{output:"b2c,b2c_signatures,abis",chain_id:e,contracts:t},headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}});if(!a.data[0])return(0,k.xe)(void 0);t=t.toLowerCase(),r=`0x${r.slice(2).toLowerCase()}`;let{erc20OfInterest:n,method:i,plugin:s}=a.data[0].b2c?.contracts?.find(e=>e.address===t)?.selectors?.[r]||{},{signature:o,serialized_data:c}=a.data[0].b2c_signatures?.[t]?.[r]||{};if(!n||!i||!s||!o||!c)return(0,k.xe)(void 0);let l=a.data[0].abis?.[t];return l?(0,k.xe)({selectorDetails:{method:i,plugin:s,erc20OfInterest:n,signature:o,serializedData:c},abi:l}):(0,k.xe)(void 0)}catch{return(0,k.MN)(Error("[ContextModule] HttpExternalPluginDataSource: Error fetching dapp infos"))}}};U=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?$(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&M(t,r,i),i})([(0,N._G)(),(a=(0,N.WQ)(P.Config),(e,t)=>a(e,t,0))],U);var B=r(72220),V=r(7008),H=Object.defineProperty,W=Object.getOwnPropertyDescriptor,G=(e,t)=>(r,a)=>t(r,a,e);let j=class{_externalPluginDataSource;_tokenDataSource;constructor(e,t){this._externalPluginDataSource=e,this._tokenDataSource=t}async load(e){if(!e.to||!e.data||"0x"===e.data)return[];let t=e.data.slice(0,10);if(!(0,B.isHexaString)(t))return[{type:x.ERROR,error:Error("Invalid selector")}];let r=await this._externalPluginDataSource.getDappInfos({address:e.to,chainId:e.chainId,selector:t});return(0,k.o3)(async({liftEither:t})=>{let a=await t(r);if(!a)return[];let n={type:x.EXTERNAL_PLUGIN,payload:a.selectorDetails.serializedData.concat(a.selectorDetails.signature)},i=this.getDecodedCallData(a.abi,a.selectorDetails.method,e.data);if(i.isLeft())return[{type:x.ERROR,error:i.extract()},n];let s=i.extract(),o=a.selectorDetails.erc20OfInterest.map(async t=>this.getTokenPayload(e,t,s));return[...(await Promise.all(o)).map(e=>e.caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.TOKEN,payload:e})})),n]}).caseOf({Left:e=>[{type:x.ERROR,error:e}],Right:e=>e})}getTokenPayload(e,t,r){let a=this.getAddressFromPath(t,r);return(0,k.o3)(({fromPromise:t})=>t(this._tokenDataSource.getTokenInfosPayload({address:a,chainId:e.chainId})))}getDecodedCallData(e,t,r){try{let a=new V.KA(e);return(0,k.xe)(a.decodeFunctionData(t,r))}catch{return(0,k.MN)(Error("[ContextModule] ExternalPluginContextLoader: Unable to parse abi"))}}getAddressFromPath(e,t){let r=t;for(let t of e.split("."))r="-1"===t?r[r.length-1]:r[t];if(!(0,B.isHexaString)(r))throw Error("[ContextModule] ExternalPluginContextLoader: Unable to get address");return r}};j=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?W(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&H(t,r,i),i})([(0,N._G)(),G(0,(0,N.WQ)(A.ExternalPluginDataSource)),G(1,(0,N.WQ)(R.TokenDataSource))],j);let X=()=>new N.i0((e,t,r,a)=>{e(A.ExternalPluginDataSource).to(U),e(A.ExternalPluginContextLoader).to(j)});var z=Object.defineProperty,q=Object.getOwnPropertyDescriptor;let Y=class{async getSetPluginPayload({chainId:e,address:t,selector:r}){try{let a=await L.A.request({method:"GET",url:`https://nft.api.live.ledger.com/v1/ethereum/${e}/contracts/${t}/plugin-selector/${r}`,headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}});return a.data.payload?(0,k.xe)(a.data.payload):(0,k.MN)(Error("[ContextModule] HttpNftDataSource: unexpected empty response"))}catch{return(0,k.MN)(Error("[ContextModule] HttpNftDataSource: Failed to fetch set plugin payload"))}}async getNftInfosPayload({chainId:e,address:t}){try{let r=await L.A.request({method:"GET",url:`https://nft.api.live.ledger.com/v1/ethereum/${e}/contracts/${t}`,headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}});return r.data.payload?(0,k.xe)(r.data.payload):(0,k.MN)(Error("[ContextModule] HttpNftDataSource: no nft metadata"))}catch{return(0,k.MN)(Error("[ContextModule] HttpNftDataSource: Failed to fetch nft informations"))}}};Y=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?q(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&z(t,r,i),i})([(0,N._G)()],Y);var K=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,J=(e=>(e.Approve="0x095ea7b3",e.SetApprovalForAll="0xa22cb465",e.TransferFrom="0x23b872dd",e.SafeTransferFrom="0x42842e0e",e.SafeTransferFromWithData="0xb88d4fde",e))(J||{}),Z=(e=>(e.SetApprovalForAll="0xa22cb465",e.SafeTransferFrom="0xf242432a",e.SafeBatchTransferFrom="0x2eb2c2d6",e))(Z||{});let ee=[...Object.values(J),...Object.values(Z)],et=class{_dataSource;constructor(e){this._dataSource=e}async load(e){let t=[];if(!e.to||!e.data||"0x"===e.data)return[];let r=e.data.slice(0,10);if(!(0,B.isHexaString)(r))return[{type:x.ERROR,error:Error("Invalid selector")}];if(!this.isSelectorSupported(r))return[];let a=(await this._dataSource.getSetPluginPayload({chainId:e.chainId,address:e.to,selector:r})).caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.PLUGIN,payload:e})});if(a.type===x.ERROR)return[a];t.push(a);let n=(await this._dataSource.getNftInfosPayload({chainId:e.chainId,address:e.to})).caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.NFT,payload:e})});return n.type===x.ERROR?[n]:(t.push(n),t)}async loadField(e){return e.type!==x.NFT?null:(await this._dataSource.getNftInfosPayload({address:e.address,chainId:e.chainId})).caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.NFT,payload:e})})}isSelectorSupported(e){return Object.values(ee).includes(e)}};et=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?Q(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&K(t,r,i),i})([(0,N._G)(),(n=(0,N.WQ)(_.NftDataSource),(e,t)=>n(e,t,0))],et);let er=()=>new N.i0((e,t,r,a)=>{e(_.NftDataSource).to(Y),e(_.NftContextLoader).to(et)}),ea="81ff";class en{static stringToHex(e){let t="";for(let r=0;r<e.length;r++)t+=e.charCodeAt(r).toString(16).padStart(2,"0");return t}static appendSignatureToPayload(e,t,r){t.length%2!=0&&(t="0"+t);let a=(t.length/2).toString(16);return a.length%2!=0&&(a="0"+a),`${e}${r}${a}${t}`}}var ei=(e=>(e.GenuineCheck="genuine_check",e.ExchangePayload="exchange_payload",e.NftMeta="nft_meta",e.TrustedName="trusted_name",e.BackupProvider="backup_provider",e.ProtectOrchestrator="protect_orchestrator",e.PluginMeta="plugin_meta",e.CoinMeta="coin_meta",e.SeedIdAuth="seed_id_auth",e.TxSimulationSigner="tx_simu_signer",e.Calldata="calldata",e.Network="network",e))(ei||{});class es{static keyUsageMap=new Map([[ei.GenuineCheck,1],[ei.ExchangePayload,2],[ei.NftMeta,3],[ei.TrustedName,4],[ei.BackupProvider,5],[ei.ProtectOrchestrator,6],[ei.PluginMeta,7],[ei.CoinMeta,8],[ei.SeedIdAuth,9],[ei.TxSimulationSigner,10],[ei.Calldata,11],[ei.Network,12]]);static mapKeyUsageForFirmware(e){return this.keyUsageMap.get(e)??-1}}var eo=Object.defineProperty,ec=Object.getOwnPropertyDescriptor;let el=class{constructor(e){this.config=e}async fetchCertificate(e){let t={output:"descriptor",target_device:e.targetDevice,latest:!0,public_key_id:e.keyId,public_key_usage:e.keyUsage};try{let r=await L.A.request({method:"GET",url:`${this.config.cal.url}/certificates`,params:t,headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}});if(!(200==r.status&&void 0!==r.data&&r.data.length>0&&this.isValidPkiCertificateResponse(r.data[0],this.config.cal.mode)))return(0,k.MN)(Error("[ContextModule] HttpPkiCertificateDataSource: failed to fetch PKI for given descriptor"));{let t=(0,B.hexaStringToBuffer)(en.appendSignatureToPayload(r.data[0].descriptor.data,r.data[0].descriptor.signatures[this.config.cal.mode],"15"));if(!t)return(0,k.MN)(Error("[ContextModule] HttpPkiCertificateDataSource: Cannot generate payload from fetched PKI Certificate"));let a={payload:t,keyUsageNumber:es.mapKeyUsageForFirmware(e.keyUsage)};return(0,k.xe)(a)}}catch{return(0,k.MN)(Error("[ContextModule] HttpPkiCertificateDataSource: failed to fetch PKI for given descriptor"))}}isValidPkiCertificateResponse(e,t){return"object"==typeof e&&null!==e&&"descriptor"in e&&"object"==typeof e.descriptor&&null!==e.descriptor&&"data"in e.descriptor&&"string"==typeof e.descriptor.data&&"signatures"in e.descriptor&&"object"==typeof e.descriptor.signatures&&null!==e.descriptor.signatures&&t in e.descriptor.signatures&&"string"==typeof e.descriptor.signatures[t]}};el=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?ec(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eo(t,r,i),i})([(0,N._G)(),(i=(0,N.WQ)(P.Config),(e,t)=>i(e,t,0))],el);let ed={PkiCertificateDataSource:Symbol.for("PkiCertificateDataSource"),PkiCertificateLoader:Symbol.for("PkiCertificateLoader")};var eu=Object.defineProperty,ep=Object.getOwnPropertyDescriptor;let eh=class{_dataSource;constructor(e){this._dataSource=e}async loadCertificate(e){return(await this._dataSource.fetchCertificate(e)).orDefault(void 0)}};eh=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?ep(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eu(t,r,i),i})([(0,N._G)(),(s=(0,N.WQ)(ed.PkiCertificateDataSource),(e,t)=>s(e,t,0))],eh);let ef=()=>new N.i0((e,t,r,a)=>{e(ed.PkiCertificateDataSource).to(el),e(ed.PkiCertificateLoader).to(eh)});var eg=Object.defineProperty,em=Object.getOwnPropertyDescriptor;let ey=class{constructor(e){this.config=e}async getTokenInfosPayload({chainId:e,address:t}){try{let r=(await L.A.request({method:"GET",url:`${this.config.cal.url}/tokens`,params:{contract_address:t,chain_id:e,output:"descriptor,ticker",ref:`branch:${this.config.cal.branch}`},headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}})).data?.[0];if(!r||!r.ticker||!r.descriptor||!r.descriptor.data||!r.descriptor.signatures||"string"!=typeof r.descriptor.signatures[this.config.cal.mode])return(0,k.MN)(Error(`[ContextModule] HttpTokenDataSource: no token metadata for address ${t} on chain ${e}`));let a=r.ticker.length.toString(16).padStart(2,"0");return(0,k.xe)([a,r.descriptor.data,r.descriptor.signatures[this.config.cal.mode]].join(""))}catch{return(0,k.MN)(Error("[ContextModule] HttpTokenDataSource: Failed to fetch token informations"))}}};ey=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?em(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eg(t,r,i),i})([(0,N._G)(),(o=(0,N.WQ)(P.Config),(e,t)=>o(e,t,0))],ey);var eE=Object.defineProperty,eC=Object.getOwnPropertyDescriptor,eS=(e=>(e.Approve="0x095ea7b3",e.Transfer="0xa9059cbb",e))(eS||{});let eI=Object.values(eS),eT=class{_dataSource;constructor(e){this._dataSource=e}async load(e){if(!e.to||!e.data||"0x"===e.data)return[];let t=e.data.slice(0,10);return(0,B.isHexaString)(t)?this.isSelectorSupported(t)?[(await this._dataSource.getTokenInfosPayload({address:e.to,chainId:e.chainId})).caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.TOKEN,payload:e})})]:[]:[{type:x.ERROR,error:Error("Invalid selector")}]}async loadField(e){return e.type!==x.TOKEN?null:(await this._dataSource.getTokenInfosPayload({address:e.address,chainId:e.chainId})).caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.TOKEN,payload:e})})}isSelectorSupported(e){return Object.values(eI).includes(e)}};eT=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?eC(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eE(t,r,i),i})([(0,N._G)(),(c=(0,N.WQ)(R.TokenDataSource),(e,t)=>c(e,t,0))],eT);let ev=()=>new N.i0((e,t,r,a)=>{e(R.TokenDataSource).to(ey),e(R.TokenContextLoader).to(eT)});var eA=(e=>(e.Test="test",e.PersoV2="persov2",e.LedgerRootV3="ledger_root_v3",e.PluginSelectorKey="plugin_selector_key",e.NftMetadataKey="nft_metadata_key",e.PartnerMetadataKey="partner_metadata_key",e.Erc20MetadataKey="erc20_metadata_key",e.DomainMetadataKey="domain_metadata_key",e.CalCalldataKey="cal_calldata_key",e.CalTrustedNameKey="cal_trusted_name_key",e.CalNetwork="cal_network",e))(eA||{}),e_=Object.defineProperty,ex=Object.getOwnPropertyDescriptor,eR=(e,t)=>(r,a)=>t(r,a,e);let ew=class{constructor(e,t){this.config=e,this._certificateLoader=t}async getTransactionDescriptors({chainId:e,address:t,selector:r,deviceModelId:a}){let n;try{n=(await L.A.request({method:"GET",url:`${this.config.cal.url}/dapps`,params:{output:"descriptors_calldata",chain_id:e,contracts:t,ref:`branch:${this.config.cal.branch}`},headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}})).data}catch(e){return(0,k.MN)(Error(`[ContextModule] HttpTransactionDataSource: Failed to fetch transaction informations: ${e}`))}if(!Array.isArray(n))return(0,k.MN)(Error("[ContextModule] HttpTransactionDataSource: Response is not an array"));if(0===n.length)return(0,k.MN)(Error(`[ContextModule] HttpTransactionDataSource: No data for contract ${t} and selector ${r}`));for(let e of n){t=t.toLowerCase(),r=`0x${r.slice(2).toLowerCase()}`;let n=e.descriptors_calldata?.[t]?.[r];if(!n||!this.isCalldataDescriptorV1(n,this.config.cal.mode))continue;let i=n.transaction_info.descriptor.data,s=n.transaction_info.descriptor.signatures[this.config.cal.mode],o={targetDevice:a,keyUsage:ei.Calldata,keyId:eA.CalCalldataKey},c=await this._certificateLoader.loadCertificate(o),l={type:x.TRANSACTION_INFO,payload:en.appendSignatureToPayload(i,s,ea),certificate:c},d=[];for(let[e,t]of Object.entries(n.enums))for(let[r,{data:a,signatures:n}]of Object.entries(t))d.push({type:x.ENUM,id:Number(e),value:Number(r),payload:en.appendSignatureToPayload(a,n[this.config.cal.mode],ea),certificate:c});let u=n.fields.map(e=>({type:x.TRANSACTION_FIELD_DESCRIPTION,payload:e.descriptor,reference:this.getReference(e.param)}));return(0,k.xe)([l,...d,...u])}return(0,k.MN)(Error(`[ContextModule] HttpTransactionDataSource: Invalid response for contract ${t} and selector ${r}`))}getReference(e){return"TOKEN_AMOUNT"===e.type&&void 0!==e.token&&"path"===e.token.type?{type:x.TOKEN,valuePath:this.toGenericPath(e.token.binary_path)}:"TOKEN_AMOUNT"===e.type&&void 0!==e.token&&"constant"===e.token.type?{type:x.TOKEN,value:e.token.value}:"NFT"===e.type&&"path"===e.collection.type?{type:x.NFT,valuePath:this.toGenericPath(e.collection.binary_path)}:"NFT"===e.type&&"constant"===e.collection.type?{type:x.NFT,value:e.collection.value}:"TRUSTED_NAME"===e.type&&"path"===e.value.type?{type:x.TRUSTED_NAME,valuePath:this.toGenericPath(e.value.binary_path),types:e.types,sources:e.sources}:"ENUM"===e.type&&"path"===e.value.type?{type:x.ENUM,valuePath:this.toGenericPath(e.value.binary_path),id:e.id}:void 0}toGenericPath(e){return"CONTAINER"===e.type?e.value:e.elements.map(e=>{if("ARRAY"===e.type){let{weight:t,...r}=e;return{itemSize:t,...r}}if("LEAF"===e.type){let{leaf_type:t,...r}=e;return{leafType:t,...r}}return e})}isCalldataDescriptorV1(e,t){return"object"==typeof e&&"calldata"===e.type&&"v1"===e.version&&this.isTransactionInfoV1(e.transaction_info,t)&&this.isEnumV1(e.enums,t)&&Array.isArray(e.fields)&&e.fields.every(e=>this.isFieldV1(e))}isTransactionInfoV1(e,t){return"object"==typeof e&&"object"==typeof e.descriptor&&"string"==typeof e.descriptor.data&&"object"==typeof e.descriptor.signatures&&"string"==typeof e.descriptor.signatures[t]}isEnumV1(e,t){return"object"==typeof e&&Object.entries(e).every(([e,r])=>"string"==typeof e&&"object"==typeof r&&Object.entries(r).every(([e,r])=>"string"==typeof e&&"object"==typeof r&&"string"==typeof r.data&&void 0!==r.signatures&&this.isCalldataSignatures(r.signatures,t)))}isCalldataSignatures(e,t){return"object"==typeof e&&"string"==typeof e[t]}isFieldV1(e){return"object"==typeof e&&"string"==typeof e.descriptor&&"object"==typeof e.param&&"object"==typeof e.param.value&&this.isDescriptorValueV1(e.param.value)&&("RAW"===e.param.type||"AMOUNT"===e.param.type||"DATETIME"===e.param.type||"DURATION"===e.param.type||"UNIT"===e.param.type||"ENUM"===e.param.type||"NFT"===e.param.type&&this.isDescriptorValueV1(e.param.collection)||"TOKEN_AMOUNT"===e.param.type&&(void 0===e.param.token||this.isDescriptorValueV1(e.param.token))||"TRUSTED_NAME"===e.param.type&&Array.isArray(e.param.types)&&Array.isArray(e.param.sources)&&e.param.types.every(e=>"string"==typeof e)&&e.param.sources.every(e=>"string"==typeof e))}isDescriptorValueV1(e){return"object"==typeof e&&"string"==typeof e.type_family&&["UINT","INT","UFIXED","FIXED","ADDRESS","BOOL","BYTES","STRING"].includes(e.type_family)&&(typeof e.type_size>"u"||"number"==typeof e.type_size)&&("path"===e.type&&this.isCalldataDescriptorValueBinaryPathV1(e)||"constant"===e.type&&this.isCalldataDescriptorValueConstantV1(e))}isCalldataDescriptorValueConstantV1(e){return"object"==typeof e&&"constant"===e.type&&"string"==typeof e.value}isCalldataDescriptorValueBinaryPathV1(e){return"object"==typeof e&&("path"===e.type&&"CONTAINER"===e.binary_path.type&&["FROM","TO","VALUE"].includes(e.binary_path.value)||"DATA"===e.binary_path.type&&Array.isArray(e.binary_path.elements)&&e.binary_path.elements.every(e=>this.isPathElementV1(e)))}isPathElementV1(e){return"object"==typeof e&&("REF"===e.type||"TUPLE"===e.type&&"number"==typeof e.offset||"ARRAY"===e.type&&"number"==typeof e.weight&&(typeof e.start>"u"||"number"==typeof e.start)&&(typeof e.end>"u"||"number"==typeof e.end)||"LEAF"===e.type&&"string"==typeof e.leaf_type&&["ARRAY_LEAF","TUPLE_LEAF","STATIC_LEAF","DYNAMIC_LEAF"].includes(e.leaf_type)||"SLICE"===e.type&&(typeof e.start>"u"||"number"==typeof e.start)&&(typeof e.end>"u"||"number"==typeof e.end))}};ew=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?ex(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&e_(t,r,i),i})([(0,N._G)(),eR(0,(0,N.WQ)(P.Config)),eR(1,(0,N.WQ)(ed.PkiCertificateLoader))],ew);var eb=Object.defineProperty,eD=Object.getOwnPropertyDescriptor;let eN=class{constructor(e){this.transactionDataSource=e}async load(e){if(!e.to||!e.data||"0x"===e.data)return[];let t=e.data.slice(0,10);return(0,B.isHexaString)(t)?(await this.transactionDataSource.getTransactionDescriptors({deviceModelId:e.deviceModelId,address:e.to,chainId:e.chainId,selector:t})).caseOf({Left:e=>[{type:x.ERROR,error:e}],Right:e=>e}):[{type:x.ERROR,error:Error("Invalid selector")}]}};eN=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?eD(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eb(t,r,i),i})([(0,N._G)(),(l=(0,N.WQ)(T.TransactionDataSource),(e,t)=>l(e,t,0))],eN);let eP=()=>new N.i0((e,t,r,a)=>{e(T.TransactionDataSource).to(ew),e(T.TransactionContextLoader).to(eN)});var eO=Object.defineProperty,eL=Object.getOwnPropertyDescriptor;let ek=class{constructor(e){this.config=e}async getDomainNamePayload({chainId:e,domain:t,challenge:r}){try{let a=await L.A.request({method:"GET",url:`https://nft.api.live.ledger.com/v2/names/ethereum/${e}/forward/${t}?types=eoa&sources=ens&challenge=${r}`,headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}});return a.data.signedDescriptor?.data?(0,k.xe)(a.data.signedDescriptor.data):(0,k.MN)(Error("[ContextModule] HttpTrustedNameDataSource: error getting domain payload"))}catch{return(0,k.MN)(Error("[ContextModule] HttpTrustedNameDataSource: Failed to fetch domain name"))}}async getTrustedNamePayload({chainId:e,address:t,challenge:r,sources:a,types:n}){try{a=a.filter(e=>"ens"===e||"crypto_asset_list"===e);let i=(await L.A.request({method:"GET",url:`https://nft.api.live.ledger.com/v2/names/ethereum/${e}/reverse/${t}?types=${n.join(",")}&sources=${a.join(",")}&challenge=${r}`,headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}})).data;if(!i?.signedDescriptor?.data)return(0,k.MN)(Error(`[ContextModule] HttpTrustedNameDataSource: no trusted name metadata for address ${t}`));let s=i.signedDescriptor.data;if(!i.signedDescriptor.signatures||"string"!=typeof i.signedDescriptor.signatures[this.config.cal.mode])return(0,k.xe)(s);let o=i.signedDescriptor.signatures[this.config.cal.mode];return(0,k.xe)(this.formatTrustedName(s,o))}catch{return(0,k.MN)(Error("[ContextModule] HttpTrustedNameDataSource: Failed to fetch trusted name"))}}formatTrustedName(e,t){t.length%2!=0&&(t="0"+t);let r=(t.length/2).toString(16);return`${e}15${r}${t}`}};ek=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?eL(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eO(t,r,i),i})([(0,N._G)(),(d=(0,N.WQ)(P.Config),(e,t)=>d(e,t,0))],ek);var eF=Object.defineProperty,eM=Object.getOwnPropertyDescriptor;let e$=class{_dataSource;constructor(e){this._dataSource=e}async load(e){let{chainId:t,domain:r,challenge:a}=e;return r&&a?this.isDomainValid(r)?[(await this._dataSource.getDomainNamePayload({chainId:t,domain:r,challenge:a})).caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.TRUSTED_NAME,payload:e})})]:[{type:x.ERROR,error:Error("[ContextModule] TrustedNameLoader: invalid domain")}]:[]}async loadField(e){return e.type!==x.TRUSTED_NAME?null:(await this._dataSource.getTrustedNamePayload({chainId:e.chainId,address:e.address,challenge:e.challenge,types:e.types,sources:e.sources})).caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.TRUSTED_NAME,payload:e})})}isDomainValid(e){let t=e.length>0&&30>Number(e.length),r=RegExp("^[a-zA-Z0-9\\-\\_\\.]+$").test(e);return t&&r}};e$=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?eM(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eF(t,r,i),i})([(0,N._G)(),(u=(0,N.WQ)(v.TrustedNameDataSource),(e,t)=>u(e,t,0))],e$);let eU=()=>new N.i0((e,t,r,a)=>{e(v.TrustedNameDataSource).to(ek),e(v.TrustedNameContextLoader).to(e$)});var eB=r(86105),eV=r.n(eB),eH=Object.defineProperty,eW=Object.getOwnPropertyDescriptor;let eG=class{constructor(e){this.config=e}async getTypedDataFilters({chainId:e,address:t,schema:r,version:a}){let n;try{let i=await L.A.request({method:"GET",url:`${this.config.cal.url}/dapps`,params:{contracts:t,chain_id:e,output:"descriptors_eip712",descriptors_eip712_version:a,descriptors_eip712:"<set>",ref:`branch:${this.config.cal.branch}`},headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}}),s=eV()(JSON.stringify(this.sortTypes(r)).replace(" ","")).toString();t=t.toLowerCase();let o=i.data?.[0]?.descriptors_eip712?.[t]?.[s];if(!o)return(0,k.MN)(Error(`[ContextModule] HttpTypedDataDataSource: no typed data filters for address ${t} on chain ${e} for schema ${s}`));if(!o.schema||!Array.isArray(o.instructions))return(0,k.MN)(Error(`[ContextModule] HttpTypedDataDataSource: no message info for address ${t} on chain ${e} for schema ${s}`));let c=[];for(let r of o.instructions)if(this.isInstructionContractInfo(r,this.config.cal.mode))n={displayName:r.display_name,signature:r.signatures[this.config.cal.mode],filtersCount:r.field_mappers_count};else if("v1"===a&&this.isInstructionFieldV1(r,this.config.cal.mode))c.push({type:"raw",displayName:r.display_name,path:r.field_path,signature:r.signatures[this.config.cal.mode]});else if(this.isInstructionFieldV2(r,this.config.cal.mode))c.push({type:r.format,displayName:r.display_name,path:r.field_path,signature:r.signatures[this.config.cal.mode]});else if(this.isInstructionFieldV2WithCoinRef(r,this.config.cal.mode))c.push({type:r.format,displayName:r.display_name,path:r.field_path,signature:r.signatures[this.config.cal.mode],tokenIndex:r.coin_ref});else{if(!this.isInstructionFieldV2WithName(r,this.config.cal.mode))return(0,k.MN)(Error(`[ContextModule] HttpTypedDataDataSource: invalid typed data field for address ${t} on chain ${e} for schema ${s}`));c.push({type:r.format,displayName:r.display_name,path:r.field_path,signature:r.signatures[this.config.cal.mode],types:r.name_types,sources:r.name_sources,typesAndSourcesPayload:this.formatTrustedNameTypesAndSources(r)})}return n?(0,k.xe)({messageInfo:n,filters:c}):(0,k.MN)(Error(`[ContextModule] HttpTypedDataDataSource: no message info for address ${t} on chain ${e} for schema ${s}`))}catch{return(0,k.MN)(Error("[ContextModule] HttpTypedDataDataSource: Failed to fetch typed data informations"))}}formatTrustedNameTypesAndSources(e){let t=e.name_types.length,r=e.name_sources.length,a=e.descriptor.slice(-((t+r)*2),-2*r),n=e.descriptor.slice(-2*r);return t.toString(16).padStart(2,"0")+a+r.toString(16).padStart(2,"0")+n}isInstructionFieldV1(e,t){return"object"==typeof e&&"string"==typeof e.display_name&&"string"==typeof e.field_path&&"object"==typeof e.signatures&&"string"==typeof e.signatures[t]}isInstructionFieldV2(e,t){return"object"==typeof e&&"string"==typeof e.display_name&&"string"==typeof e.field_path&&"object"==typeof e.signatures&&"string"==typeof e.signatures[t]&&"string"==typeof e.format&&["raw","datetime"].includes(e.format)&&void 0===e.coin_ref}isInstructionFieldV2WithCoinRef(e,t){return"object"==typeof e&&"string"==typeof e.display_name&&"string"==typeof e.field_path&&"object"==typeof e.signatures&&"string"==typeof e.signatures[t]&&"string"==typeof e.format&&["token","amount"].includes(e.format)&&"number"==typeof e.coin_ref}isInstructionFieldV2WithName(e,t){return"object"==typeof e&&"string"==typeof e.display_name&&"string"==typeof e.field_path&&"object"==typeof e.signatures&&"string"==typeof e.signatures[t]&&"string"==typeof e.format&&"trusted-name"===e.format&&void 0===e.coin_ref&&Array.isArray(e.name_types)&&Array.isArray(e.name_sources)&&e.name_types.every(e=>"string"==typeof e)&&e.name_sources.every(e=>"string"==typeof e)}isInstructionContractInfo(e,t){return"object"==typeof e&&"string"==typeof e.display_name&&"number"==typeof e.field_mappers_count&&"object"==typeof e.signatures&&"string"==typeof e.signatures[t]&&void 0===e.field_path}sortTypes(e){return Object.fromEntries(Object.entries(e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>[e,t.map(e=>({name:e.name,type:e.type}))]))}};eG=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?eW(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&eH(t,r,i),i})([(0,N._G)(),(p=(0,N.WQ)(P.Config),(e,t)=>p(e,t,0))],eG);var ej=Object.defineProperty,eX=Object.getOwnPropertyDescriptor,ez=(e,t)=>(r,a)=>t(r,a,e);let eq=class{constructor(e,t){this.dataSource=e,this.tokenDataSource=t}async load(e){let t=await this.dataSource.getTypedDataFilters({address:e.verifyingContract,chainId:e.chainId,version:e.version,schema:e.schema});if(t.isLeft())return{type:"error",error:t.extract()};let{messageInfo:r,filters:a}=t.unsafeCoerce(),n={},i={},s={};for(let t of a){if(n[t.path]=t,"trusted-name"===t.type){let r=e.fieldsValues.filter(e=>e.path===t.path);if(0!==r.length){let e=r[0],a=this.convertAddressToHexaString(e.value);i[t.path]=a}continue}if("token"!==t.type&&"amount"!==t.type)continue;let r=t.tokenIndex;if(void 0===s[r]){if("token"===t.type){let a=e.fieldsValues.filter(e=>e.path===t.path);if(0===a.length)continue;let n=a[0],i=this.convertAddressToHexaString(n.value);if(a.every(e=>this.convertAddressToHexaString(e.value)===i)){let t=e.chainId;(await this.tokenDataSource.getTokenInfosPayload({address:i,chainId:t})).ifRight(e=>{s[r]=e})}}else if("amount"===t.type&&255===r){let t=e.verifyingContract,a=e.chainId;(await this.tokenDataSource.getTokenInfosPayload({address:t,chainId:a})).ifRight(e=>{s[r]=e})}}}return{type:"success",messageInfo:r,filters:n,trustedNamesAddresses:i,tokens:s}}convertAddressToHexaString(e){return`0x${Array.from(e,e=>e.toString(16).padStart(2,"0")).join("").padStart(40,"0")}`}};eq=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?eX(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&ej(t,r,i),i})([(0,N._G)(),ez(0,(0,N.WQ)(w.TypedDataDataSource)),ez(1,(0,N.WQ)(R.TokenDataSource))],eq);let eY=()=>new N.i0((e,t,r,a)=>{e(w.TypedDataDataSource).to(eG),e(w.TypedDataContextLoader).to(eq)}),eK=["function execute(bytes calldata commands, bytes[] calldata inputs, uint256 deadline) external payable"],eQ="0x3593564c";var eJ=(e=>(e.V2_SWAP_EXACT_IN="V2_SWAP_EXACT_IN",e.V2_SWAP_EXACT_OUT="V2_SWAP_EXACT_OUT",e.V3_SWAP_EXACT_IN="V3_SWAP_EXACT_IN",e.V3_SWAP_EXACT_OUT="V3_SWAP_EXACT_OUT",e.WRAP_ETH="WRAP_ETH",e.UNWRAP_ETH="UNWRAP_ETH",e.PERMIT2_PERMIT="PERMIT2_PERMIT",e.PERMIT2_TRANSFER_FROM="PERMIT2_TRANSFER_FROM",e.PERMIT2_PERMIT_BATCH="PERMIT2_PERMIT_BATCH",e.PERMIT2_TRANSFER_FROM_BATCH="PERMIT2_TRANSFER_FROM_BATCH",e.PAY_PORTION="PAY_PORTION",e.SWEEP="SWEEP",e))(eJ||{});let eZ={"0x08":"V2_SWAP_EXACT_IN","0x09":"V2_SWAP_EXACT_OUT","0x00":"V3_SWAP_EXACT_IN","0x01":"V3_SWAP_EXACT_OUT","0x0b":"WRAP_ETH","0x0c":"UNWRAP_ETH","0x0a":"PERMIT2_PERMIT","0x0d":"PERMIT2_TRANSFER_FROM","0x02":"PERMIT2_PERMIT_BATCH","0x03":"PERMIT2_TRANSFER_FROM_BATCH","0x06":"PAY_PORTION","0x04":"SWEEP"},e0=["V2_SWAP_EXACT_IN","V2_SWAP_EXACT_OUT","V3_SWAP_EXACT_IN","V3_SWAP_EXACT_OUT"];var e1=(e=>(e[e.ETHEREUM_MAINNET=1]="ETHEREUM_MAINNET",e[e.ETHEREUM_GOERLI=5]="ETHEREUM_GOERLI",e[e.ETHEREUM_SEPOLIA=0xaa36a7]="ETHEREUM_SEPOLIA",e[e.ARBITRUM_ONE=42161]="ARBITRUM_ONE",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.AVALANCHE_C_CHAIN=43114]="AVALANCHE_C_CHAIN",e[e.BSC=56]="BSC",e[e.BASE=8453]="BASE",e[e.BASE_GOERLI=84531]="BASE_GOERLI",e[e.BLAST=23888]="BLAST",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_GOERLI=420]="OPTIMISM_GOERLI",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e))(e1||{});let e2={1:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",5:"0xB4FBF271143F4FBf7B91A5ded31805e42b2208d6",0xaa36a7:"0xfFf9976782d46CC05630D1f6eBAb18b2324d6B14",42161:"0x82aF49447D8a07e3bd95BD0d56f35241523fBab1",421613:"0xe39Ab88f8A4777030A534146A9Ca3B52bd5D43A3",43114:"0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7",56:"0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c",8453:"0x4200000000000000000000000000000000000006",84531:"0x44D627f900da8AdaC7561bD73aA745F132450798",23888:"0x4300000000000000000000000000000000000004",10:"0x4200000000000000000000000000000000000006",420:"0x4200000000000000000000000000000000000006",137:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",80001:"0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889"};var e3=Object.defineProperty,e4=Object.getOwnPropertyDescriptor;let e8=class{constructor(e){this.abiDecoder=e}decode(e,t,r){switch(e){case eJ.V2_SWAP_EXACT_IN:case eJ.V2_SWAP_EXACT_OUT:return this._decodeSwapV2(t);case eJ.V3_SWAP_EXACT_IN:case eJ.V3_SWAP_EXACT_OUT:return this._decodeSwapV3(t);case eJ.WRAP_ETH:case eJ.UNWRAP_ETH:return this._decodeWrappedEth(t,r);case eJ.SWEEP:return this._decodeSweep(t);case eJ.PERMIT2_PERMIT:case eJ.PERMIT2_TRANSFER_FROM:case eJ.PERMIT2_PERMIT_BATCH:case eJ.PERMIT2_TRANSFER_FROM_BATCH:case eJ.PAY_PORTION:default:return[]}}_decodeSwapV2(e){let[,,,t]=this.abiDecoder.decode(["address","uint256","uint256","address[]","bool"],e);return Array.isArray(t)&&t.every(B.isHexaString)?t.map(e=>e.toLowerCase()):[]}_decodeSwapV3(e){let[,,,t]=this.abiDecoder.decode(["address","uint256","uint256","bytes","bool"],e);if("string"!=typeof t||!(0,B.isHexaString)(t)||t.length<88)return[];let r=[];for(let e=2;e<t.length;e+=46)r.push(t.slice(e,e+40));return r.map(e=>e.toLowerCase()).map(e=>`0x${e}`)}_isSupportedChainId(e){return Object.values(e1).includes(e)}_decodeWrappedEth(e,t){return this._isSupportedChainId(t)?[e2[t].toLowerCase()]:[]}_decodeSweep=e=>{let[t]=this.abiDecoder.decode(["address","address","uint256"],e);return"string"==typeof t&&(0,B.isHexaString)(t)?[t.toLowerCase()]:[]}};e8=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?e4(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&e3(t,r,i),i})([(0,N._G)(),(h=(0,N.WQ)(b.AbiDecoderDataSource),(e,t)=>h(e,t,0))],e8);var e5=r(82642),e6=Object.defineProperty,e9=Object.getOwnPropertyDescriptor;let e7=class{decode(e,t){try{return e5.y.defaultAbiCoder().decode(e,t)}catch{return[]}}};e7=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?e9(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&e6(t,r,i),i})([(0,N._G)()],e7);let te="Uniswap";var tt=Object.defineProperty,tr=Object.getOwnPropertyDescriptor,ta=(e,t)=>(r,a)=>t(r,a,e);let tn=class{constructor(e,t){this.commandDecoderDataSource=e,this.tokenDataSource=t}async load(e){if(!e.data||!(0,B.isHexaString)(e.data)||e.data.slice(0,10)!==eQ)return[];let t=this._buildUniswapPluginCommandData(),r=await this._extractClearSignContexts(e.data,e.chainId);return r.length>0?[t,...r]:[]}_buildUniswapPluginCommandData(){let e=new B.ByteArrayBuilder().add8BitUIntToData(te.length).addAsciiStringToData(te).addBufferToData((0,B.hexaStringToBuffer)("0x3fc91a3afd70395cd496c647d5a6cc9d4b2b7fad")).addBufferToData((0,B.hexaStringToBuffer)(eQ)).addBufferToData((0,B.hexaStringToBuffer)("0x3044022014391e8f355867a57fe88f6a5a4dbcb8bf8f888a9db3ff3449caf72d120396bd02200c13d9c3f79400fe0aa0434ac54d59b79503c9964a4abc3e8cd22763e0242935")).build();return{type:x.EXTERNAL_PLUGIN,payload:(0,B.bufferToHexaString)(e).slice(2)}}async _extractClearSignContexts(e,t){try{let r=new V.KA(eK).parseTransaction({data:e}),a=r?.args[0],n=r?.args[1];if(!(0,B.isHexaString)(a)||!this._isHexaStringArray(n))return[];let i=this._extractCommands(a).orDefault([]);if(0===a.length||n.length!==i.length)return[];let s=i.reduce((e,r,a)=>{let i=n[a],s=this.commandDecoderDataSource.decode(r,i,t);return e.push([r,s]),e},[]);if(!this._isChainingSwapSupported(s))return[];let o=[...new Set(s.flatMap(([,e])=>e))];return(await Promise.all(o.map(e=>this.tokenDataSource.getTokenInfosPayload({address:e,chainId:t})))).map(e=>e.caseOf({Left:e=>({type:x.ERROR,error:e}),Right:e=>({type:x.TOKEN,payload:e})}))}catch{return[]}}_extractCommands(e){return k.bW.fromNullable(e.slice(2).match(/../g)).map(e=>e.map(e=>`0x${e}`)).map(e=>e.map(e=>eZ[e])).chain(e=>e.every(e=>void 0!==e)?k.bW.of(e):k.Cl)}_isChainingSwapSupported(e){let t,r;for(let[a,n]of e){if(!e0.includes(a))continue;let e=a.slice(0,2);if(t&&(t!==n[0]||r!==e))return!1;t=n[n.length-1],r=e}return!0}_isHexaStringArray(e){return Array.isArray(e)&&e.every(e=>"string"==typeof e&&(0,B.isHexaString)(e))}};tn=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?tr(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&tt(t,r,i),i})([(0,N._G)(),ta(0,(0,N.WQ)(b.CommandDecoderDataSource)),ta(1,(0,N.WQ)(R.TokenDataSource))],tn);let ti=()=>new N.i0((e,t,r,a)=>{e(b.AbiDecoderDataSource).to(e7),e(b.CommandDecoderDataSource).to(e8),e(b.UniswapContextLoader).to(tn)});var ts=Object.defineProperty,to=Object.getOwnPropertyDescriptor,tc=(e,t)=>(r,a)=>t(r,a,e);let tl=class{constructor(e,t){this.config=e,this._certificateLoader=t}async getWeb3Checks(e){let t,r,a;let{from:n,deviceModelId:i}=e;this.isTypedDataContext(e)?(r={msg:{from:n,data:e.data}},a=`${this.config.web3checks.url}/ethereum/scan/eip-712`):(r={tx:{from:n,raw:e.rawTx},chain:e.chainId},a=`${this.config.web3checks.url}/ethereum/scan/tx`);try{t=(await L.A.request({method:"POST",url:a,data:r,headers:{"X-Ledger-Client-Version":`context-module/${F.rE}`}})).data}catch{return(0,k.MN)(Error("[ContextModule] HttpWeb3CheckDataSource: Failed to fetch web3 checks informations"))}if(!this.isWeb3CheckDto(t))return(0,k.MN)(Error("[ContextModule] HttpWeb3CheckDataSource: Cannot exploit Web3 checks data received"));let s=await this._certificateLoader.loadCertificate({keyId:t.public_key_id,keyUsage:ei.TxSimulationSigner,targetDevice:i}),o={publicKeyId:t.public_key_id,descriptor:t.descriptor,certificate:s};return(0,k.xe)(o)}isTypedDataContext(e){return"data"in e}isWeb3CheckDto(e){return null!=e&&"object"==typeof e&&"public_key_id"in e&&null!=e.public_key_id&&"string"==typeof e.public_key_id&&"descriptor"in e&&null!=e.descriptor&&"string"==typeof e.descriptor}};tl=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?to(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&ts(t,r,i),i})([(0,N._G)(),tc(0,(0,N.WQ)(P.Config)),tc(1,(0,N.WQ)(ed.PkiCertificateLoader))],tl);var td=Object.defineProperty,tu=Object.getOwnPropertyDescriptor;let tp=class{_dataSource;constructor(e){this._dataSource=e}async load(e){return await this._dataSource.getWeb3Checks(e)}};tp=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?tu(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&td(t,r,i),i})([(0,N._G)(),(f=(0,N.WQ)(D.Web3CheckDataSource),(e,t)=>f(e,t,0))],tp);let th=()=>new N.i0((e,t,r,a)=>{e(D.Web3CheckDataSource).to(tl),e(D.Web3CheckContextLoader).to(tp)}),tf=({config:e})=>{let t=new N.mc;return t.load(O(e),X(),er(),ev(),eP(),eU(),eY(),ef(),ti(),th()),t};class tg{_container;_loaders;_typedDataLoader;_web3CheckLoader;constructor(e){this._container=tf({config:e}),this._loaders=e.defaultLoaders?this._getDefaultLoaders():[],this._loaders.push(...e.customLoaders),this._typedDataLoader=e.customTypedDataLoader??this._getDefaultTypedDataLoader(),this._web3CheckLoader=e.customWeb3CheckLoader??this._getWeb3CheckLoader()}_getDefaultLoaders(){return[this._container.get(A.ExternalPluginContextLoader),this._container.get(v.TrustedNameContextLoader),this._container.get(_.NftContextLoader),this._container.get(R.TokenContextLoader),this._container.get(T.TransactionContextLoader),this._container.get(b.UniswapContextLoader)]}_getDefaultTypedDataLoader(){return this._container.get(w.TypedDataContextLoader)}_getWeb3CheckLoader(){return this._container.get(D.Web3CheckContextLoader)}async getContexts(e){let t=this._loaders.map(t=>t.load(e));return(await Promise.all(t)).flat()}async getContext(e){let t=this._loaders.filter(e=>e.loadField).map(t=>t.loadField(e));return(await Promise.all(t)).find(e=>null!==e)||{type:x.ERROR,error:Error(`Field type not supported: ${e.type}`)}}async getTypedDataFilters(e){return this._typedDataLoader.load(e)}async getWeb3Checks(e){return(await this._web3CheckLoader.load(e)).caseOf({Right:e=>({type:x.WEB3_CHECK,payload:e.descriptor,certificate:e.certificate}),Left:()=>null})}}let tm={cal:{url:"https://crypto-assets-service.api.ledger.com/v1",mode:"prod",branch:"main"},web3checks:{url:"https://web3checks-backend.api.ledger.com/v3"},defaultLoaders:!0,customLoaders:[],customTypedDataLoader:void 0};class ty{config=tm;constructor(){}removeDefaultLoaders(){return this.config.defaultLoaders=!1,this}addLoader(e){return this.config.customLoaders.push(e),this}addTypedDataLoader(e){return this.config.customTypedDataLoader=e,this}addWeb3CheckLoader(e){return this.config.customWeb3CheckLoader=e,this}addCalConfig(e){return this.config.cal={...tm.cal,...e},this}addWeb3ChecksConfig(e){return this.config.web3checks={...tm.web3checks,...e},this}build(){return new tg(this.config)}}r(54050),r(20204),r(70204),r(97717);var tE=(e=>(e.FROM="FROM",e.TO="TO",e.VALUE="VALUE",e))(tE||{}),tC=(e=>(e.TUPLE="TUPLE",e.ARRAY="ARRAY",e.REF="REF",e.LEAF="LEAF",e.SLICE="SLICE",e))(tC||{}),tS=(e=>(e.STATIC_LEAF="STATIC_LEAF",e.DYNAMIC_LEAF="DYNAMIC_LEAF",e.TUPLE_LEAF="TUPLE_LEAF",e.ARRAY_LEAF="ARRAY_LEAF",e))(tS||{});r(80055),r(38058);let tI={GetAddressUseCase:Symbol.for("GetAddressUseCase")},tT={AppBinding:Symbol.for("AppBinder")};var tv=Object.defineProperty,tA=Object.getOwnPropertyDescriptor;let t_=class{_appBinder;constructor(e){this._appBinder=e}execute(e,t){return this._appBinder.getAddress({derivationPath:e,checkOnDevice:t?.checkOnDevice,returnChainCode:t?.returnChainCode})}};t_=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?tA(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&tv(t,r,i),i})([(0,N._G)(),(g=(0,N.WQ)(tT.AppBinding),(e,t)=>g(e,t,0))],t_);let tx=()=>new N.i0((e,t,r,a,n,i,s)=>{e(tI.GetAddressUseCase).to(t_)});var tR=r(94696),tw=r(63286),tb=r(57497),tD=r(52812);class tN{constructor(e,t,r=B.CommandUtils.isSuccessResponse){this._errors=e,this._errorFactory=t,this._isSuccessResponse=r}getError(e){let t=new B.ApduParser(e).encodeToHexaString(e.statusCode);return(0,B.isCommandErrorCode)(t,this._errors)?(0,B.CommandResultFactory)({error:this._errorFactory({...this._errors[t],errorCode:t})}):this._isSuccessResponse(e)?void 0:(0,B.CommandResultFactory)({error:B.GlobalCommandErrorHandler.handle(e)})}}class tP{static PADDING=0x80000000;static splitPath(e){let t=[];return e.split("/").forEach(e=>{let r=parseInt(e,10);if(isNaN(r))throw Error("invalid number provided");e.length>1&&"'"===e[e.length-1]&&(r+=this.PADDING),t.push(r)}),t}}let tO={6001:{message:"Mode check fail"},6501:{message:"TransactionType not supported"},6502:{message:"Output buffer too small for chainId conversion"},6800:{message:"Internal error (Please report)"},6982:{message:"Security status not satisfied (Canceled by user)"},6983:{message:"Wrong Data length"},6984:{message:"Plugin not installed"},6985:{message:"Condition not satisfied"},"6a00":{message:"Error without info"},"6a80":{message:"Invalid data"},"6a84":{message:"Insufficient memory"},"6a88":{message:"Data not found"},"6b00":{message:"Incorrect parameter P1 or P2"},"6d00":{message:"Incorrect parameter INS"},"6e00":{message:"Incorrect parameter CLA"},"6f00":{message:"Technical problem (Internal error, please report)"},"911c":{message:"Command code not supported (i.e., Ledger-PKI not yet available)"}};class tL extends B.DeviceExchangeError{constructor(e){super({tag:"EthAppCommandError",...e})}}let tk=e=>new tL(e);class tF{errorHelper=new tN(tO,tk);constructor(){}getApdu(){return new B.ApduBuilder({cla:224,ins:6,p1:0,p2:0}).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e),r=t.extract8BitUInt();if(void 0===r)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Cannot extract config flags")});let a=t.extract8BitUInt(),n=t.extract8BitUInt(),i=t.extract8BitUInt();if(void 0===a||void 0===n||void 0===i)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Cannot extract version")});let s={blindSigningEnabled:!!(1&r),web3ChecksEnabled:!!(16&r),web3ChecksOptIn:!!(32&r),version:`${a}.${n}.${i}`};return(0,B.CommandResultFactory)({data:s})})}}class tM{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let{derivationPath:e,legacyArgs:t}=this.args,r={cla:224,ins:12,p1:0,p2:+!t.isJust()},a=tP.splitPath(e),n=new B.ApduBuilder(r);for(let e of(n.add8BitUIntToData(a.length),a))n.add32BitUIntToData(e);return t.ifJust(({domainHash:e,messageHash:t})=>{n.addHexaStringToData(e),n.addHexaStringToData(t)}),n.build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e),r=t.extract8BitUInt();if(void 0===r)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("V is missing")});let a=t.encodeToHexaString(t.extractFieldByLength(32),!0);if(!a)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("R is missing")});let n=t.encodeToHexaString(t.extractFieldByLength(32),!0);return n?(0,B.CommandResultFactory)({data:{r:a,s:n,v:r}}):(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("S is missing")})})}}class t${errorHelper=new tN(tO,tk);constructor(){}getApdu(){return new B.ApduBuilder({cla:224,ins:50,p1:1,p2:0}).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e).extract8BitUInt();return void 0===t?(0,B.CommandResultFactory)({data:{enabled:!1}}):(0,B.CommandResultFactory)({data:{enabled:0!==t}})})}}let tU=["1inch","Aave","Alkemi","Angle","APWine","ArtBlocks","Brick Towers","capsa","cBridge","ChorusOne","CIAN","Coinbase","Cometh","Compound","DODO","EigenLayer","ENS","Figment","Harvest","Kelp","Kiln","Lens","libertify","Lido","[ L ] Market","Midas","Morpho","Nested","OKX Web3","OpenSea","P2P.org","Paraswap","POAP","QuickSwap","Rarible","Ribbon","Ricochet","Rocket Pool","Spool","Squid","Staderlabs","StakeDAO","StakeKit","Swell","Thales","Yearn","Uniswap"];var tB=r(91672);class tV{args;errorHelper=new tN(tO,tk);constructor(e){this.args=e}getApdu(){let e={cla:224,ins:2,p1:+!!this.args.checkOnDevice,p2:+!!this.args.returnChainCode},t=new B.ApduBuilder(e),r=this.args.derivationPath,a=tP.splitPath(r);return t.add8BitUIntToData(a.length),a.forEach(e=>{t.add32BitUIntToData(e)}),t.add32BitUIntToData(0),t.add32BitUIntToData(1),t.build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t;let r=new B.ApduParser(e),a=r.extract8BitUInt();if(void 0===a)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Public key length is missing")});if(!1===r.testMinimalLength(a))return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Public key is missing")});let n=r.encodeToHexaString(r.extractFieldByLength(a)),i=r.extract8BitUInt();if(void 0===i)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Ethereum address length is missing")});if(!1===r.testMinimalLength(i))return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Ethereum address is missing")});let s=`0x${r.encodeToString(r.extractFieldByLength(i))}`;if(!1===(0,B.isHexaString)(s))return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Invalid Ethereum address")});if(this.args.returnChainCode){if(!1===r.testMinimalLength(32))return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Invalid Chaincode")});t=r.encodeToHexaString(r.extractFieldByLength(32))}return(0,B.CommandResultFactory)({data:{publicKey:n,address:s,chainCode:t}})})}}class tH{constructor(e,t){this.api=e,this.args=t}async run(){let e;let t=await this.api.sendCommand(new tV({derivationPath:this.args.derivationPath,checkOnDevice:!1,returnChainCode:!1}));if(!(0,B.isSuccessCommandResult)(t))return{web3Check:null,error:t.error};let r=t.data.address,{deviceModelId:a}=this.api.getDeviceSessionState(),{contextModule:n}=this.args;if(this.isRawTx(this.args)){let t=this.args.mapper.mapTransactionToSubset(this.args.transaction);if(t.isRight()){let{subset:i,serializedTransaction:s}=t.extract(),o={deviceModelId:a,from:r,rawTx:(0,B.bufferToHexaString)(s),chainId:i.chainId};e=await n.getWeb3Checks(o)}else throw t.extract()}else{let t={deviceModelId:a,from:r,data:this.args.data};e=await n.getWeb3Checks(t)}return null===e||e?.type!==x.WEB3_CHECK?{web3Check:null}:{web3Check:e}}isRawTx(e){return"transaction"in e}}var tW=r(39555);class tG{isCompatible=!0;version="0.0.1";modelId;constructor(e,t){if(this.modelId=e.deviceModelId,e.sessionStateType===B.DeviceSessionStateType.Connected||"Ethereum"!==e.currentApp.name&&!tU.includes(e.currentApp.name)){this.isCompatible=!1;return}"Ethereum"===e.currentApp.name?this.version=e.currentApp.version:this.version=t.version}withMinVersionInclusive(e){return(0,tW.gte)(this.version,e)||(this.isCompatible=!1),this}withMinVersionExclusive(e){return(0,tW.gt)(this.version,e)||(this.isCompatible=!1),this}excludeDeviceModel(e){return this.modelId===e&&(this.isCompatible=!1),this}check(){return this.isCompatible}}class tj{constructor(e,t,r){this.typeName=e,this.name=t,this.size=r}}class tX{constructor(e,t,r,a,n){this.typeName=e,this.rootType=t,this.rowType=r,this.count=a,this.levels=n}}class tz{constructor(e){this.typeName=e}}class tq{constructor(e){this.root=e}}class tY{constructor(e){this.length=e}}class tK{constructor(e){this.data=e}}class tQ{constructor(e,t,r,a,n,i,s=(e,t)=>new tH(e,t)){this.api=e,this.contextModule=t,this.parser=r,this.data=a,this.derivationPath=n,this.appConfig=i,this.getWeb3ChecksFactory=s}async run(){let e=null;this.appConfig.web3ChecksEnabled&&(e=(await this.getWeb3ChecksFactory(this.api,{contextModule:this.contextModule,derivationPath:this.derivationPath,data:this.data}).run()).web3Check);let t=tB.z.hashDomain(this.data.domain);if(!this.data.types[this.data.primaryType])throw Error(`Primary type "${this.data.primaryType}" is not defined in the types.`);let{EIP712Domain:r,...a}=this.data.types,n=tB.z.hashStruct(this.data.primaryType,a,this.data.message),i=this.parser.parse(this.data);if(i.isLeft())throw i.extract();let{types:s,domain:o,message:c}=i.unsafeCoerce(),l=k.Cl,d=this.getClearSignVersion();if(d.isJust()){let e=this.data.domain.verifyingContract?.toLowerCase()||"0x0000000000000000000000000000000000000000",t=this.data.domain.chainId||0,r=c.filter(e=>e.value instanceof tK).map(e=>({path:e.path,value:e.value.data})),a=await this.contextModule.getTypedDataFilters({verifyingContract:e,chainId:t,version:d.extract(),schema:this.data.types,fieldsValues:r});"success"===a.type&&(l=(0,k.V1)(a))}return{web3Check:e,types:s,domain:o,message:c,clearSignContext:l,domainHash:t,messageHash:n}}getClearSignVersion(){let e=this.api.getDeviceSessionState();return new tG(e,this.appConfig).withMinVersionInclusive("1.10.0").excludeDeviceModel(B.DeviceModelId.NANO_S).check()?new tG(e,this.appConfig).withMinVersionInclusive("1.12.0").check()?(0,k.V1)("v2"):(0,k.V1)("v1"):k.Cl}}class tJ{errorHelper=new tN(tO,tk);constructor(){}getApdu(){return new B.ApduBuilder({cla:224,ins:32,p1:0,p2:0}).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e);if(!1===t.testMinimalLength(4))return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Challenge key is missing")});let r=t.encodeToHexaString(t.extractFieldByLength(4));return(0,B.CommandResultFactory)({data:{challenge:r}})})}}class tZ{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){return new B.ApduBuilder({cla:224,ins:10,p1:0,p2:0}).addHexaStringToData(this.args.payload).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e).extract8BitUInt()??0;return(0,B.CommandResultFactory)({data:{tokenIndex:t}})})}}class t0{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:34,p1:+!!this.args.isFirstChunk,p2:0};return new B.ApduBuilder(e).addBufferToData(this.args.data).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class t1{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:50,p1:0,p2:+!!this.args.isFirstChunk};return new B.ApduBuilder(e).addBufferToData(this.args.payload).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}var t2=(e=>(e.Activation="activation",e.DiscardedPath="discarded_path",e.MessageInfo="message_info",e.Datetime="datetime",e.Raw="raw",e.Amount="amount",e.Token="token",e.TrustedName="trusted-name",e))(t2||{});let t3={activation:0,discarded_path:1,message_info:15,"trusted-name":251,datetime:252,token:253,amount:254,raw:255};class t4{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:30,p1:"discarded"in this.args&&this.args.discarded?1:0,p2:t3[this.args.type]},t=new B.ApduBuilder(e);switch(this.args.type){case"message_info":t.encodeInLVFromAscii(this.args.displayName).add8BitUIntToData(this.args.filtersCount).encodeInLVFromHexa(this.args.signature);break;case"discarded_path":t.encodeInLVFromAscii(this.args.path);break;case"datetime":case"raw":t.encodeInLVFromAscii(this.args.displayName).encodeInLVFromHexa(this.args.signature);break;case"trusted-name":t.encodeInLVFromAscii(this.args.displayName).addHexaStringToData(this.args.typesAndSourcesPayload).encodeInLVFromHexa(this.args.signature);break;case"token":case"amount":"amount"===this.args.type&&t.encodeInLVFromAscii(this.args.displayName),t.add8BitUIntToData(this.args.tokenIndex).encodeInLVFromHexa(this.args.signature)}return t.build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}var t8=(e=>(e[e.Name=0]="Name",e[e.Field=255]="Field",e))(t8||{});class t5{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:26,p1:0,p2:this.args.command};if(0===this.args.command)return new B.ApduBuilder(e).addAsciiStringToData(this.args.name).build();let t=new B.ApduBuilder(e),r=this.constructTypeDescByte(this.args.type);if(t.add8BitUIntToData(r),this.getTypeCustomName(this.args.type).ifJust(e=>{t.encodeInLVFromAscii(e)}),this.getTypeSize(this.args.type).ifJust(e=>{t.add8BitUIntToData(e)}),this.args.type instanceof tX)for(let e of(t.add8BitUIntToData(this.args.type.levels.length),this.args.type.levels))e.caseOf({Just:e=>{t.add8BitUIntToData(1).add8BitUIntToData(e)},Nothing:()=>{t.add8BitUIntToData(0)}});return t.encodeInLVFromAscii(this.args.name).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}constructTypeDescByte(e){return+(e instanceof tX)<<7|+!!this.getTypeSize(e).isJust()<<6|this.getType(e)}getTypeSize(e){return e instanceof tX?this.getTypeSize(e.rootType):e instanceof tj?e.size:k.Cl}getTypeCustomName(e){return e instanceof tX?this.getTypeCustomName(e.rootType):e instanceof tz?(0,k.V1)(e.typeName):k.Cl}getType(e){if(e instanceof tX)return this.getType(e.rootType);if(e instanceof tz)return 0;switch(e.name){case"int":return 1;case"uint":return 2;case"address":return 3;case"bool":return 4;case"string":return 5;case"bytes":return e.size.isJust()?6:7}}}var t6=(e=>(e[e.ROOT=0]="ROOT",e[e.ARRAY=15]="ARRAY",e[e.FIELD=255]="FIELD",e))(t6||{});class t9{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:28,p1:255!=this.args.type||this.args.value.isLastChunk?0:1,p2:this.args.type};switch(this.args.type){case 0:return new B.ApduBuilder(e).addAsciiStringToData(this.args.value).build();case 15:return new B.ApduBuilder(e).add8BitUIntToData(this.args.value).build();case 255:return new B.ApduBuilder(e).addBufferToData(this.args.value.data).build()}}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class t7{constructor(e,t){this.api=e,this.args=t}async run(){if(this.args.type!==t6.FIELD)return await this.api.sendCommand(new t9(this.args));let e=(0,B.CommandResultFactory)({data:void 0}),t=new B.ByteArrayBuilder(this.args.value.length+2).add16BitUIntToData(this.args.value.length).addBufferToData(this.args.value).build();for(let r=0;r<t.length&&(e=await this.api.sendCommand(new t9({type:t6.FIELD,value:{data:t.slice(r,r+B.APDU_MAX_PAYLOAD),isLastChunk:r>=t.length-B.APDU_MAX_PAYLOAD}})),(0,B.isSuccessCommandResult)(e));r+=B.APDU_MAX_PAYLOAD);return e}}class re{static PAYLOAD_LENGTH_BYTES=2;static getBufferFromPayload(e){let t=(0,B.hexaStringToBuffer)(e);return null===t||0===t.length?null:new B.ByteArrayBuilder(t.length+this.PAYLOAD_LENGTH_BYTES).add16BitUIntToData(t.length).addBufferToData(t).build()}}class rt{constructor(e,t){this.api=e,this.args=t}async run(){let{data:e,commandFactory:t}=this.args,r=new B.ByteArrayBuilder(e.length).addBufferToData(e).build();for(let e=0;e<r.length;e+=B.APDU_MAX_PAYLOAD){let a=e+B.APDU_MAX_PAYLOAD>=r.length,n=await this.api.sendCommand(t({chunkedData:r.slice(e,e+B.APDU_MAX_PAYLOAD),isFirstChunk:0===e}));if(!(0,B.isSuccessCommandResult)(n))return n;if(a)return(0,B.CommandResultFactory)({data:n.data})}throw new B.InvalidStatusWordError("No result")}}class rr{constructor(e,t){this.api=e,this.args=t}async run(){let e=re.getBufferFromPayload(this.args.payload);return e?new rt(this.api,{data:e,commandFactory:this.args.commandFactory}).run():(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("Invalid payload")})}}class ra{constructor(e,t,r){for(let a of(this.api=e,this.contextModule=t,this.args=r,this.args.domain))if("chainId"===a.path&&a.value instanceof tK){let e=BigInt((0,B.bufferToHexaString)(a.value.data));e<=Number.MAX_SAFE_INTEGER&&(this.chainId=(0,k.V1)(Number(e)));break}}chainId=k.Cl;async run(){this.args.web3Check&&(this.args.web3Check.certificate&&await this.api.sendCommand(new B.LoadCertificateCommand({keyUsage:this.args.web3Check.certificate.keyUsageNumber,certificate:this.args.web3Check.certificate.payload})),await new rr(this.api,{payload:this.args.web3Check.payload,commandFactory:e=>new t1({payload:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run());let e=(0,B.CommandResultFactory)({data:void 0});for(let[e,t]of Object.entries(this.args.types).sort(([e],[t])=>e.localeCompare(t))){let r=await this.api.sendCommand(new t5({command:t8.Name,name:e}));if(!(0,B.isSuccessCommandResult)(r))return r;for(let[e,r]of Object.entries(t)){let t=await this.api.sendCommand(new t5({command:t8.Field,name:e,type:r}));if(!(0,B.isSuccessCommandResult)(t))return t}}if(this.args.clearSignContext.isJust()){let e=await this.api.sendCommand(new t4({type:t2.Activation}));if(!(0,B.isSuccessCommandResult)(e))return e}for(let e of this.args.domain){let t=await this.getImplementationTask(e).run();if(!(0,B.isSuccessCommandResult)(t))return t}if(this.args.clearSignContext.isJust()){let e=this.args.clearSignContext.extract(),t=await this.api.sendCommand(new t4({type:t2.MessageInfo,displayName:e.messageInfo.displayName,filtersCount:e.messageInfo.filtersCount,signature:e.messageInfo.signature}));if(!(0,B.isSuccessCommandResult)(t))return t}let t={indexes:{},nextIndex:0};for(let e of this.args.message){let r=await this.provideTokenInformation(e,t);if(r.isJust())return r.extract();let a=await this.provideTrustedName(e);if(a.isJust())return a.extract();let n=await this.filterValue(e,t);if(n.isJust()&&!(0,B.isSuccessCommandResult)(n.extract()))return n.extract();let i=await this.getImplementationTask(e).run();if(!(0,B.isSuccessCommandResult)(i))return i;if(this.args.clearSignContext.isJust()&&e.value instanceof tY&&0===e.value.length)for(let r of Object.entries(this.args.clearSignContext.extract().filters).filter(([t])=>t.startsWith(`${e.path}.[]`)).map(([,e])=>e)){let e=await this.api.sendCommand(new t4({type:t2.DiscardedPath,path:r.path}));if(!(0,B.isSuccessCommandResult)(e))return e;let a=await this.provideFiltering(r,t,!0);if(!(0,B.isSuccessCommandResult)(a))return a}}return e}getImplementationTask(e){return e.value instanceof tq?new t7(this.api,{type:t6.ROOT,value:e.value.root}):e.value instanceof tY?new t7(this.api,{type:t6.ARRAY,value:e.value.length}):new t7(this.api,{type:t6.FIELD,value:e.value.data})}async provideTokenInformation(e,t){if(this.args.clearSignContext.isJust()){let r=this.args.clearSignContext.extract().filters[e.path];if(void 0!==r&&("amount"===r.type||"token"===r.type)&&void 0===t.indexes[r.tokenIndex]){let e=r.tokenIndex,a=this.args.clearSignContext.extract().tokens[e];if(void 0===a)return k.Cl;let n=await this.api.sendCommand(new tZ({payload:a}));if(!(0,B.isSuccessCommandResult)(n))return k.bW.of(n);let{tokenIndex:i}=n.data;t.nextIndex=(i+1)%5,255===Number(e)&&(i=255),t.indexes[Number(e)]=i}}return k.Cl}async provideTrustedName(e){if(this.args.clearSignContext.isJust()&&this.chainId.isJust()){let t=this.args.clearSignContext.extract(),r=t.filters[e.path],a=t.trustedNamesAddresses[e.path];if(void 0!==r&&"trusted-name"===r.type&&void 0!==a){let e=await this.api.sendCommand(new tJ);if(!(0,B.isSuccessCommandResult)(e))return(0,k.V1)(e);let t=await this.contextModule.getContext({type:x.TRUSTED_NAME,chainId:this.chainId.extract(),address:a,challenge:e.data.challenge,types:r.types,sources:r.sources});if(t.type===x.TRUSTED_NAME){t.certificate&&await this.api.sendCommand(new B.LoadCertificateCommand({keyUsage:t.certificate.keyUsageNumber,certificate:t.certificate.payload}));let e=await new rr(this.api,{payload:t.payload,commandFactory:e=>new t0({data:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();if(!(0,B.isSuccessCommandResult)(e))return(0,k.V1)(e)}}}return k.Cl}async filterValue(e,t){if(this.args.clearSignContext.isJust()){let r=this.args.clearSignContext.extract().filters[e.path];if(void 0===r)return k.Cl;let a=await this.provideFiltering(r,t,!1);return k.bW.of(a)}return k.Cl}async provideFiltering(e,t,r){switch(e.type){case"trusted-name":return await this.api.sendCommand(new t4({type:t2.TrustedName,discarded:r,displayName:e.displayName,typesAndSourcesPayload:e.typesAndSourcesPayload,signature:e.signature}));case"datetime":return await this.api.sendCommand(new t4({type:t2.Datetime,discarded:r,displayName:e.displayName,signature:e.signature}));case"raw":return await this.api.sendCommand(new t4({type:t2.Raw,discarded:r,displayName:e.displayName,signature:e.signature}));case"token":return this.sanitizeDeviceIndex(e.tokenIndex,t),await this.api.sendCommand(new t4({type:t2.Token,discarded:r,tokenIndex:t.indexes[e.tokenIndex],signature:e.signature}));case"amount":return this.sanitizeDeviceIndex(e.tokenIndex,t),await this.api.sendCommand(new t4({type:t2.Amount,discarded:r,displayName:e.displayName,tokenIndex:t.indexes[e.tokenIndex],signature:e.signature}));default:return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("ProvideEIP712ContextTask/provideFiltering - Unhandled filter type")})}}sanitizeDeviceIndex(e,t){void 0===t.indexes[e]&&(t.indexes[e]=t.nextIndex,t.nextIndex=(t.nextIndex+1)%5)}}class rn extends B.XStateDeviceAction{makeStateMachine(e){let{getAppConfig:t,web3CheckOptIn:r,buildContext:a,provideContext:n,signTypedData:i,signTypedDataLegacy:s}=this.extractDependencies(e);return(0,tR.mj)({types:{input:{},context:{},output:{}},actors:{openAppStateMachine:new B.OpenAppDeviceAction({input:{appName:"Ethereum"}}).makeStateMachine(e),getAppConfig:(0,tw.Sx)(t),web3CheckOptIn:(0,tw.Sx)(r),buildContext:(0,tw.Sx)(a),provideContext:(0,tw.Sx)(n),signTypedData:(0,tw.Sx)(i),signTypedDataLegacy:(0,tw.Sx)(s)},guards:{noInternalError:({context:e})=>null===e._internalState.error,notRefusedByUser:({context:e})=>null!==e._internalState.error&&(!("errorCode"in e._internalState.error)||"6985"!==e._internalState.error.errorCode),isWeb3ChecksSupported:({context:t})=>new tG(e.getDeviceSessionState(),t._internalState.appConfig).withMinVersionExclusive("1.15.0").excludeDeviceModel(B.DeviceModelId.NANO_S).check(),shouldOptIn:({context:e})=>!e._internalState.appConfig.web3ChecksEnabled&&!e._internalState.appConfig.web3ChecksOptIn},actions:{assignErrorFromEvent:(0,tb.a)({_internalState:e=>({...e.context._internalState,error:e.event.error})})}}).createMachine({id:"SignTypedDataDeviceAction",initial:"OpenAppDeviceAction",context:({input:e})=>({input:e,intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.OPEN_APP},_internalState:{error:null,appConfig:null,typedDataContext:null,signature:null}}),states:{OpenAppDeviceAction:{exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.OPEN_APP}}),invoke:{id:"openAppStateMachine",input:{appName:"Ethereum",compatibleAppNames:tU},src:"openAppStateMachine",onSnapshot:{actions:(0,tb.a)({intermediateValue:e=>({...e.event.snapshot.context.intermediateValue,step:S.OPEN_APP})})},onDone:{actions:(0,tb.a)({_internalState:e=>e.event.output.caseOf({Right:()=>e.context._internalState,Left:t=>({...e.context._internalState,error:t})})}),target:"CheckOpenAppDeviceActionResult"}}},CheckOpenAppDeviceActionResult:{always:[{target:"GetAppConfig",guard:"noInternalError"},"Error"]},GetAppConfig:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.GET_APP_CONFIG}}),invoke:{id:"getAppConfig",src:"getAppConfig",onDone:{target:"GetAppConfigResultCheck",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>(0,B.isSuccessCommandResult)(e.output)?{...t._internalState,appConfig:e.output.data}:{...t._internalState,error:e.output.error}})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},GetAppConfigResultCheck:{always:[{target:"Web3ChecksOptIn",guard:(0,tD.D)(["noInternalError","isWeb3ChecksSupported","shouldOptIn"])},{target:"BuildContext",guard:"noInternalError"},{target:"Error"}]},Web3ChecksOptIn:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.Web3ChecksOptIn,step:S.WEB3_CHECKS_OPT_IN}}),exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.WEB3_CHECKS_OPT_IN}}),invoke:{id:"web3CheckOptIn",src:"web3CheckOptIn",onDone:{target:"BuildContext",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>(0,B.isSuccessCommandResult)(e.output)?{...t._internalState,appConfig:{...t._internalState.appConfig,web3ChecksEnabled:e.output.data.enabled}}:t._internalState})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},BuildContext:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.BUILD_CONTEXT}}),invoke:{id:"buildContext",src:"buildContext",input:({context:e})=>({contextModule:e.input.contextModule,parser:e.input.parser,data:e.input.data,appConfig:e._internalState.appConfig,derivationPath:e.input.derivationPath}),onDone:{target:"ProvideContext",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>({...t._internalState,typedDataContext:e.output})})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},ProvideContext:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.SignTypedData,step:S.PROVIDE_CONTEXT}}),exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.PROVIDE_CONTEXT}}),invoke:{id:"provideContext",src:"provideContext",input:({context:e})=>({contextModule:e.input.contextModule,taskArgs:e._internalState.typedDataContext}),onDone:{actions:(0,tb.a)({_internalState:e=>(0,B.isSuccessCommandResult)(e.event.output)?e.context._internalState:{...e.context._internalState,error:e.event.output.error}}),target:"ProvideContextResultCheck"},onError:{target:"Error",actions:"assignErrorFromEvent"}}},ProvideContextResultCheck:{always:[{guard:"noInternalError",target:"SignTypedData"},{guard:"notRefusedByUser",target:"SignTypedDataLegacy"},{target:"Error"}]},SignTypedData:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.SignTypedData,step:S.SIGN_TYPED_DATA}}),exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.SIGN_TYPED_DATA}}),invoke:{id:"signTypedData",src:"signTypedData",input:({context:e})=>({derivationPath:e.input.derivationPath}),onDone:{target:"SignTypedDataResultCheck",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>(0,B.isSuccessCommandResult)(e.output)?{...t._internalState,signature:e.output.data}:{...t._internalState,error:e.output.error}})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},SignTypedDataLegacy:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.SignTypedData,step:S.SIGN_TYPED_DATA_LEGACY}}),exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:S.SIGN_TYPED_DATA_LEGACY}}),invoke:{id:"signTypedDataLegacy",src:"signTypedDataLegacy",input:({context:e})=>({derivationPath:e.input.derivationPath,domainHash:e._internalState.typedDataContext.domainHash,messageHash:e._internalState.typedDataContext.messageHash}),onDone:{target:"SignTypedDataResultCheck",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>(0,B.isSuccessCommandResult)(e.output)?{...t._internalState,signature:e.output.data}:{...t._internalState,error:e.output.error}})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},SignTypedDataResultCheck:{always:[{guard:"noInternalError",target:"Success"},{target:"Error"}]},Success:{type:"final"},Error:{type:"final"}},output:({context:e})=>e._internalState.signature?(0,k.xe)(e._internalState.signature):(0,k.MN)(e._internalState.error||new B.UnknownDAError("No error in final state"))})}extractDependencies(e){return{getAppConfig:async()=>e.sendCommand(new tF),web3CheckOptIn:async()=>e.sendCommand(new t$),buildContext:async t=>new tQ(e,t.input.contextModule,t.input.parser,t.input.data,t.input.derivationPath,t.input.appConfig).run(),provideContext:async t=>new ra(e,t.input.contextModule,t.input.taskArgs).run(),signTypedData:async t=>e.sendCommand(new tM({derivationPath:t.input.derivationPath,legacyArgs:k.Cl})),signTypedDataLegacy:async t=>e.sendCommand(new tM({derivationPath:t.input.derivationPath,legacyArgs:(0,k.V1)({domainHash:t.input.domainHash,messageHash:t.input.messageHash})}))}}}class ri{args;errorHelper=new tN(tO,tk);constructor(e){this.args=e}getApdu(){let{data:e,isFirstChunk:t}=this.args;return new B.ApduBuilder({cla:224,ins:8,p1:128*!t,p2:0}).addBufferToData(e).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e),r=t.extract8BitUInt();if(void 0===r)return(0,B.CommandResultFactory)({data:k.Cl});let a=t.encodeToHexaString(t.extractFieldByLength(32),!0);if(!a)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("R is missing")});let n=t.encodeToHexaString(t.extractFieldByLength(32),!0);return n?(0,B.CommandResultFactory)({data:(0,k.V1)({r:a,s:n,v:r})}):(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("S is missing")})})}}class rs{constructor(e,t){this.api=e,this.args=t}async run(){let{derivationPath:e,message:t}=this.args,r=tP.splitPath(e),a=new B.ByteArrayBuilder(t.length+1+(r.length+1)*4);a.add8BitUIntToData(r.length),r.forEach(e=>{a.add32BitUIntToData(e)}),a.add32BitUIntToData(t.length),"string"==typeof t?a.addAsciiStringToData(t):a.addBufferToData(t);let n=a.build(),i=await new rt(this.api,{data:n,commandFactory:e=>new ri({data:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();return(0,B.isSuccessCommandResult)(i)?i.data.mapOrDefault(e=>(0,B.CommandResultFactory)({data:e}),(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("no signature returned")})):i}}let ro={Dmk:Symbol.for("Dmk"),SessionId:Symbol.for("SessionId"),ContextModule:Symbol.for("ContextModule")},rc={SignTransactionUseCase:Symbol.for("SignTransactionUseCase"),TransactionParserService:Symbol.for("TransactionParserService"),TransactionMapperService:Symbol.for("TransactionMapperService"),TransactionMappers:Symbol.for("TransactionMappers")};class rl{constructor(e,t,r=(e,t)=>new tH(e,t)){this.api=e,this.args=t,this.getWeb3ChecksFactory=r}async run(){let e;let{contextModule:t,mapper:r,transaction:a,options:n,appConfig:i,derivationPath:s}=this.args,o=this.api.getDeviceSessionState(),c=r.mapTransactionToSubset(a);c.ifLeft(e=>{throw e});let{subset:l,serializedTransaction:d,type:u}=c.unsafeCoerce(),p=null;i.web3ChecksEnabled&&(p=(await this.getWeb3ChecksFactory(this.api,{contextModule:t,derivationPath:s,mapper:r,transaction:a}).run()).web3Check);let h=await this.api.sendCommand(new tJ);(0,B.isSuccessCommandResult)(h)&&(e=h.data.challenge);let f=await t.getContexts({challenge:e,domain:n.domain,deviceModelId:o.deviceModelId,...l}),g=f.filter(e=>e.type!==x.ERROR&&e.type!==x.ENUM),m=f.filter(e=>e.type===x.ENUM),y=[],E=g.find(e=>e.type===x.TRANSACTION_INFO);if(E&&!E.certificate)throw Error("Transaction info certificate is missing");if(this.supportsGenericParser(o,i)&&void 0!==E){let e=g.filter(e=>e.type===x.TRANSACTION_FIELD_DESCRIPTION);y={transactionInfo:E.payload,transactionInfoCertificate:E.certificate,transactionFields:e,transactionEnums:m}}else y=g.filter(e=>e.type!==x.TRANSACTION_INFO&&e.type!==x.TRANSACTION_FIELD_DESCRIPTION);return{clearSignContexts:y,serializedTransaction:d,chainId:l.chainId,transactionType:u,web3Check:p}}supportsGenericParser(e,t){return new tG(e,t).withMinVersionExclusive("1.14.0").excludeDeviceModel(B.DeviceModelId.NANO_S).check()}}class rd{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){return new B.ApduBuilder({cla:224,ins:20,p1:0,p2:0}).addHexaStringToData(this.args.payload).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class ru{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){return new B.ApduBuilder({cla:224,ins:18,p1:0,p2:0}).addHexaStringToData(this.args.payload).addHexaStringToData(this.args.signature??"").build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class rp{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){return new B.ApduBuilder({cla:224,ins:22,p1:0,p2:0}).addHexaStringToData(this.args.payload).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class rh{constructor(e,t){this.api=e,this.args=t}async run(){for(let e of this.args.clearSignContexts){let t=await this.provideContext(e);if(!(0,B.isSuccessCommandResult)(t))return(0,k.V1)(t)}if(this.args.web3Check){let e=await this.provideContext(this.args.web3Check);if(!(0,B.isSuccessCommandResult)(e))return(0,k.V1)(e)}return k.Cl}async provideContext({type:e,payload:t,certificate:r}){switch(r&&await this.api.sendCommand(new B.LoadCertificateCommand({keyUsage:r.keyUsageNumber,certificate:r.payload})),e){case x.PLUGIN:return await this.api.sendCommand(new rp({payload:t}));case x.EXTERNAL_PLUGIN:return await this.api.sendCommand(new ru({payload:t}));case x.NFT:return await this.api.sendCommand(new rd({payload:t}));case x.TOKEN:return await this.api.sendCommand(new tZ({payload:t}));case x.TRUSTED_NAME:return new rr(this.api,{payload:t,commandFactory:e=>new t0({data:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();case x.ENUM:case x.TRANSACTION_FIELD_DESCRIPTION:case x.TRANSACTION_INFO:return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("The context type [EXTERNAL_PLUGIN] is not valid here")});case x.WEB3_CHECK:return new rr(this.api,{payload:t,commandFactory:e=>new t1({payload:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();default:return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError(`The context type [${e}] is not covered`)})}}}class rf{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:38,p1:+!!this.args.isFirstChunk,p2:0};return new B.ApduBuilder(e).addBufferToData(this.args.data).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class rg{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let{serializedTransaction:e,isFirstChunk:t}=this.args;return new B.ApduBuilder({cla:224,ins:4,p1:128*!t,p2:1}).addBufferToData(e).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class rm{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:36,p1:+!!this.args.isFirstChunk,p2:0};return new B.ApduBuilder(e).addBufferToData(this.args.data).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class ry{constructor(e){this.args=e}errorHelper=new tN(tO,tk);getApdu(){let e={cla:224,ins:40,p1:+!!this.args.isFirstChunk,p2:0};return new B.ApduBuilder(e).addBufferToData(this.args.data).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefault((0,B.CommandResultFactory)({data:void 0}))}}class rE{constructor(e,t){this.api=e,this.args=t}async run(){let{field:e}=this.args;if(await this.loadCertificate(e.certificate),void 0!==e.reference&&"value"in e.reference&&void 0!==e.reference.value&&await this.getAndProvideContext({type:e.reference.type,chainId:this.args.chainId,address:e.reference.value}),void 0!==e.reference&&void 0!==e.reference.valuePath){let t=this.args.transactionParser.extractValue(this.args.serializedTransaction,e.reference.valuePath);if(t.isRight())for(let r of t.extract()){let t=await this.provideContextReference(e.reference,r);if(t.isJust())return t}}let t=await this.provideContext({...e});return(0,B.isSuccessCommandResult)(t)?k.Cl:(0,k.V1)(t)}async loadCertificate(e){e&&await this.api.sendCommand(new B.LoadCertificateCommand({keyUsage:e.keyUsageNumber,certificate:e.payload}))}async provideContextReference(e,t){if(e.type===x.ENUM)return this.provideEnumContextReference(e,t);let r=(0,B.bufferToHexaString)(t.slice(Math.max(0,t.length-20)));return e.type===x.TRUSTED_NAME?this.provideTustedNameContextReference(e,r):this.getAndProvideContext({type:e.type,chainId:this.args.chainId,address:r})}async provideEnumContextReference(e,t){let r=t[t.length-1];if(!r)return k.Cl;let a=this.args.transactionEnums.find(t=>t.value===r&&t.id===e.id);if(a){await this.loadCertificate(a.certificate);let e=await this.provideContext(a);if(!(0,B.isSuccessCommandResult)(e))return(0,k.V1)(e)}return k.Cl}async provideTustedNameContextReference(e,t){let r=await this.api.sendCommand(new tJ);return(0,B.isSuccessCommandResult)(r)?this.getAndProvideContext({type:e.type,chainId:this.args.chainId,address:t,challenge:r.data.challenge,types:e.types,sources:e.sources}):(0,k.V1)(r)}async getAndProvideContext(e){let t=await this.args.contextModule.getContext(e);if(t.type!==x.ERROR){let e=await this.provideContext(t);if(!(0,B.isSuccessCommandResult)(e))return(0,k.V1)(e)}return k.Cl}async provideContext({type:e,payload:t}){switch(e){case x.NFT:return await this.api.sendCommand(new rd({payload:t}));case x.TOKEN:return await this.api.sendCommand(new tZ({payload:t}));case x.TRUSTED_NAME:return new rr(this.api,{payload:t,commandFactory:e=>new t0({data:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();case x.ENUM:return new rr(this.api,{payload:t,commandFactory:e=>new rm({data:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();case x.TRANSACTION_FIELD_DESCRIPTION:return new rr(this.api,{payload:t,commandFactory:e=>new ry({data:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();case x.TRANSACTION_INFO:case x.PLUGIN:case x.EXTERNAL_PLUGIN:return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError(`The context type [${e}] is not valid as a transaction field or metadata`)});case x.WEB3_CHECK:return new rr(this.api,{payload:t,commandFactory:e=>new t1({payload:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();default:return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError(`The context type [${e}] is not covered`)})}}}class rC{constructor(e,t){this.api=e,this.args=t}async run(){let e=tP.splitPath(this.args.derivationPath),t=new B.ByteArrayBuilder;t.add8BitUIntToData(e.length),e.forEach(e=>{t.add32BitUIntToData(e)}),t.addBufferToData(this.args.serializedTransaction);let r=await new rt(this.api,{data:t.build(),commandFactory:e=>new rg({serializedTransaction:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();if(!(0,B.isSuccessCommandResult)(r))return(0,k.V1)(r);if(this.args.context.transactionInfoCertificate){let{keyUsageNumber:e,payload:t}=this.args.context.transactionInfoCertificate;await this.api.sendCommand(new B.LoadCertificateCommand({keyUsage:e,certificate:t}))}let a=await new rr(this.api,{payload:this.args.context.transactionInfo,commandFactory:e=>new rf({data:e.chunkedData,isFirstChunk:e.isFirstChunk})}).run();if(!(0,B.isSuccessCommandResult)(a))return(0,k.V1)(a);for(let e of this.args.web3Check?[...this.args.context.transactionFields,this.args.web3Check]:this.args.context.transactionFields){let t=await new rE(this.api,{field:e,serializedTransaction:this.args.serializedTransaction,chainId:this.args.chainId,transactionParser:this.args.transactionParser,contextModule:this.args.contextModule,transactionEnums:this.args.context.transactionEnums}).run();if(t.isJust())return t}return k.Cl}}var rS=r(89628),rI=r(1563);class rT{errorHelper=new tN(tO,tk);args;constructor(e){this.args=e}getApdu(){let{serializedTransaction:e,isFirstChunk:t}=this.args;return new B.ApduBuilder({cla:224,ins:4,p1:128*!t,p2:0}).addBufferToData(e).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e),r=t.extract8BitUInt();if(void 0===r)return(0,B.CommandResultFactory)({data:k.Cl});let a=t.encodeToHexaString(t.extractFieldByLength(32),!0);if(!a)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("R is missing")});let n=t.encodeToHexaString(t.extractFieldByLength(32),!0);return n?(0,B.CommandResultFactory)({data:(0,k.V1)({v:r,r:a,s:n})}):(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("S is missing")})})}}class rv{errorHelper=new tN(tO,tk);getApdu(){return new B.ApduBuilder({cla:224,ins:4,p1:0,p2:2}).build()}parseResponse(e){return k.bW.fromNullable(this.errorHelper.getError(e)).orDefaultLazy(()=>{let t=new B.ApduParser(e),r=t.extract8BitUInt();if(void 0===r)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("V is missing")});let a=t.encodeToHexaString(t.extractFieldByLength(32),!0);if(!a)return(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("R is missing")});let n=t.encodeToHexaString(t.extractFieldByLength(32),!0);return n?(0,B.CommandResultFactory)({data:(0,k.V1)({v:r,r:a,s:n})}):(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("S is missing")})})}}class rA{constructor(e,t){this.api=e,this.args=t}async run(){if(!this.args.isLegacy){let e=await this.api.sendCommand(new rv);return(0,B.isSuccessCommandResult)(e)?this.recoverSignature(e.data).mapOrDefault(e=>(0,B.CommandResultFactory)({data:e}),(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("no signature returned")})):e}let{derivationPath:e,serializedTransaction:t}=this.args,r=tP.splitPath(e),a=new B.ByteArrayBuilder(t.length+1+4*r.length);a.add8BitUIntToData(r.length),r.forEach(e=>{a.add32BitUIntToData(e)});let n=a.build(),i=this.getChunks(n,t),s=k.Cl;for(let e=0;e<i.length;e++){let t=await this.api.sendCommand(new rT({serializedTransaction:i[e],isFirstChunk:0===e}));if(!(0,B.isSuccessCommandResult)(t))return t;s=t.data}return this.recoverSignature(s).mapOrDefault(e=>(0,B.CommandResultFactory)({data:e}),(0,B.CommandResultFactory)({error:new B.InvalidStatusWordError("no signature returned")}))}getChunks(e,t){let r=Uint8Array.from([...e,...t]),a=B.APDU_MAX_PAYLOAD;if(r.length<=a)return[r];if(this.args.transactionType===I.LEGACY)try{let n=(0,rS.J)(t);if(Array.isArray(n)){let t=n.slice(-3),i=(0,rI.R)(t),s=(0,B.hexaStringToBuffer)(i).subarray(1);for(a=B.APDU_MAX_PAYLOAD;a>e.length;a--){let e=r.length%a;if(0===e||e>s.length)break}}}catch{a=B.APDU_MAX_PAYLOAD}let n=0,i=[];for(;n<r.length;)i.push(r.slice(n,n+a)),n+=a;return i}recoverSignature(e){return e.map(({v:e,r:t,s:r})=>{if(this.args.transactionType!==I.LEGACY)return{v:e,r:t,s:r};let a=this.args.chainId;for(;a>0xffffffff;)a>>=8;return{v:+(e!=(2*a+35&255))+2*this.args.chainId+35,r:t,s:r}})}}class r_ extends B.XStateDeviceAction{makeStateMachine(e){let{getAppConfig:t,web3CheckOptIn:r,buildContext:a,provideContext:n,provideGenericContext:i,signTransaction:s}=this.extractDependencies(e);return(0,tR.mj)({types:{input:{},context:{},output:{}},actors:{openAppStateMachine:new B.OpenAppDeviceAction({input:{appName:"Ethereum"}}).makeStateMachine(e),getAppConfig:(0,tw.Sx)(t),web3CheckOptIn:(0,tw.Sx)(r),buildContext:(0,tw.Sx)(a),provideContext:(0,tw.Sx)(n),provideGenericContext:(0,tw.Sx)(i),signTransaction:(0,tw.Sx)(s)},guards:{noInternalError:({context:e})=>null===e._internalState.error,isGenericContext:({context:e})=>null!==e._internalState.clearSignContexts&&"string"==typeof e._internalState.clearSignContexts.transactionInfo,isWeb3ChecksSupported:({context:t})=>new tG(e.getDeviceSessionState(),t._internalState.appConfig).withMinVersionExclusive("1.15.0").excludeDeviceModel(B.DeviceModelId.NANO_S).check(),shouldOptIn:({context:e})=>!e._internalState.appConfig.web3ChecksEnabled&&!e._internalState.appConfig.web3ChecksOptIn},actions:{assignErrorFromEvent:(0,tb.a)({_internalState:e=>({...e.context._internalState,error:e.event.error})})}}).createMachine({id:"SignTransactionDeviceAction",initial:"OpenAppDeviceAction",context:({input:e})=>({input:e,intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.OPEN_APP},_internalState:{error:null,appConfig:null,clearSignContexts:null,serializedTransaction:null,chainId:null,web3Check:null,transactionType:null,isLegacy:!0,signature:null}}),states:{OpenAppDeviceAction:{exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.OPEN_APP}}),invoke:{id:"openAppStateMachine",input:{appName:"Ethereum",compatibleAppNames:tU},src:"openAppStateMachine",onSnapshot:{actions:(0,tb.a)({intermediateValue:e=>({...e.event.snapshot.context.intermediateValue,step:C.OPEN_APP})})},onDone:{actions:(0,tb.a)({_internalState:e=>e.event.output.caseOf({Right:()=>e.context._internalState,Left:t=>({...e.context._internalState,error:t})})}),target:"CheckOpenAppDeviceActionResult"}}},CheckOpenAppDeviceActionResult:{always:[{target:"GetAppConfig",guard:"noInternalError"},"Error"]},GetAppConfig:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.GET_APP_CONFIG}}),invoke:{id:"getAppConfig",src:"getAppConfig",onDone:{target:"GetAppConfigResultCheck",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>(0,B.isSuccessCommandResult)(e.output)?{...t._internalState,appConfig:e.output.data}:{...t._internalState,error:e.output.error}})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},GetAppConfigResultCheck:{always:[{target:"Web3ChecksOptIn",guard:(0,tD.D)(["noInternalError","isWeb3ChecksSupported","shouldOptIn"])},{target:"BuildContext",guard:"noInternalError"},{target:"Error"}]},Web3ChecksOptIn:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.Web3ChecksOptIn,step:C.WEB3_CHECKS_OPT_IN}}),exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.WEB3_CHECKS_OPT_IN}}),invoke:{id:"web3CheckOptIn",src:"web3CheckOptIn",onDone:{target:"BuildContext",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>(0,B.isSuccessCommandResult)(e.output)?{...t._internalState,appConfig:{...t._internalState.appConfig,web3ChecksEnabled:e.output.data.enabled}}:t._internalState})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},BuildContext:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.BUILD_CONTEXT}}),invoke:{id:"buildContext",src:"buildContext",input:({context:e})=>({contextModule:e.input.contextModule,mapper:e.input.mapper,transaction:e.input.transaction,options:e.input.options,appConfig:e._internalState.appConfig,derivationPath:e.input.derivationPath}),onDone:{target:"BuildContextResultCheck",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>({...t._internalState,clearSignContexts:e.output.clearSignContexts,web3Check:e.output.web3Check,serializedTransaction:e.output.serializedTransaction,chainId:e.output.chainId,transactionType:e.output.transactionType})})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},BuildContextResultCheck:{always:[{target:"ProvideGenericContext",guard:"isGenericContext"},{target:"ProvideContext"}]},ProvideContext:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.PROVIDE_CONTEXT}}),invoke:{id:"provideContext",src:"provideContext",input:({context:e})=>({clearSignContexts:e._internalState.clearSignContexts,web3Check:e._internalState.web3Check}),onDone:{target:"SignTransaction"},onError:{target:"Error",actions:"assignErrorFromEvent"}}},ProvideGenericContext:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.PROVIDE_GENERIC_CONTEXT}}),invoke:{id:"provideGenericContext",src:"provideGenericContext",input:({context:e})=>({contextModule:e.input.contextModule,transactionParser:e.input.parser,chainId:e._internalState.chainId,derivationPath:e.input.derivationPath,serializedTransaction:e._internalState.serializedTransaction,context:e._internalState.clearSignContexts,web3Check:e._internalState.web3Check}),onDone:{actions:(0,tb.a)({_internalState:({event:e,context:t})=>{let{isLegacy:r,...a}=t._internalState;return e.output.caseOf({Just:()=>({...a,isLegacy:!1}),Nothing:()=>({...a,isLegacy:!1})})}}),target:"SignTransaction"},onError:{target:"Error",actions:"assignErrorFromEvent"}}},SignTransaction:{entry:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.SignTransaction,step:C.SIGN_TRANSACTION}}),exit:(0,tb.a)({intermediateValue:{requiredUserInteraction:B.UserInteractionRequired.None,step:C.SIGN_TRANSACTION}}),invoke:{id:"signTransaction",src:"signTransaction",input:({context:e})=>({derivationPath:e.input.derivationPath,serializedTransaction:e._internalState.serializedTransaction,chainId:e._internalState.chainId,transactionType:e._internalState.transactionType,isLegacy:e._internalState.isLegacy}),onDone:{target:"SignTransactionResultCheck",actions:[(0,tb.a)({_internalState:({event:e,context:t})=>(0,B.isSuccessCommandResult)(e.output)?{...t._internalState,signature:e.output.data}:{...t._internalState,error:e.output.error}})]},onError:{target:"Error",actions:"assignErrorFromEvent"}}},SignTransactionResultCheck:{always:[{guard:"noInternalError",target:"Success"},{target:"Error"}]},Success:{type:"final"},Error:{type:"final"}},output:({context:e})=>e._internalState.signature?(0,k.xe)(e._internalState.signature):(0,k.MN)(e._internalState.error||new B.UnknownDAError("No error in final state"))})}extractDependencies(e){return{getAppConfig:async()=>e.sendCommand(new tF),web3CheckOptIn:async()=>e.sendCommand(new t$),buildContext:async t=>new rl(e,t.input).run(),provideContext:async t=>new rh(e,{clearSignContexts:t.input.clearSignContexts,web3Check:t.input.web3Check}).run(),provideGenericContext:async t=>new rC(e,{contextModule:t.input.contextModule,transactionParser:t.input.transactionParser,chainId:t.input.chainId,derivationPath:t.input.derivationPath,serializedTransaction:t.input.serializedTransaction,context:t.input.context,web3Check:t.input.web3Check}).run(),signTransaction:async t=>new rA(e,t.input).run()}}}var rx=Object.defineProperty,rR=Object.getOwnPropertyDescriptor,rw=(e,t)=>(r,a)=>t(r,a,e);let rb=class{constructor(e,t,r,a,n){this.dmk=e,this.contextModule=t,this.mapper=r,this.parser=a,this.sessionId=n}getAddress(e){return this.dmk.executeDeviceAction({sessionId:this.sessionId,deviceAction:new B.SendCommandInAppDeviceAction({input:{command:new tV(e),appName:"Ethereum",compatibleAppNames:tU,requiredUserInteraction:e.checkOnDevice?B.UserInteractionRequired.VerifyAddress:B.UserInteractionRequired.None}})})}signPersonalMessage(e){return this.dmk.executeDeviceAction({sessionId:this.sessionId,deviceAction:new B.CallTaskInAppDeviceAction({input:{task:async t=>new rs(t,e).run(),appName:"Ethereum",compatibleAppNames:tU,requiredUserInteraction:B.UserInteractionRequired.SignPersonalMessage}})})}signTransaction(e){return this.dmk.executeDeviceAction({sessionId:this.sessionId,deviceAction:new r_({input:{derivationPath:e.derivationPath,transaction:e.transaction,mapper:this.mapper,parser:this.parser,contextModule:this.contextModule,options:e.options??{}}})})}signTypedData(e){return this.dmk.executeDeviceAction({sessionId:this.sessionId,deviceAction:new rn({input:{derivationPath:e.derivationPath,data:e.data,parser:e.parser,contextModule:this.contextModule}})})}};rb=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?rR(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&rx(t,r,i),i})([(0,N._G)(),rw(0,(0,N.WQ)(ro.Dmk)),rw(1,(0,N.WQ)(ro.ContextModule)),rw(2,(0,N.WQ)(rc.TransactionMapperService)),rw(3,(0,N.WQ)(rc.TransactionParserService)),rw(4,(0,N.WQ)(ro.SessionId))],rb);let rD=()=>new N.i0((e,t,r,a,n,i,s)=>{e(tT.AppBinding).to(rb)}),rN={SignMessageUseCase:Symbol.for("SignMessageUseCase")};var rP=Object.defineProperty,rO=Object.getOwnPropertyDescriptor;let rL=class{_appBinder;constructor(e){this._appBinder=e}execute(e,t){return this._appBinder.signPersonalMessage({derivationPath:e,message:t})}};rL=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?rO(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&rP(t,r,i),i})([(0,N._G)(),(m=(0,N.WQ)(tT.AppBinding),(e,t)=>m(e,t,0))],rL);let rk=()=>new N.i0((e,t,r,a,n,i,s)=>{e(rN.SignMessageUseCase).to(rL)});var rF=r(43697),rM=r(51476),r$=Object.defineProperty,rU=Object.getOwnPropertyDescriptor;let rB=class{map(e){try{let t=rF.Z.from((0,B.bufferToHexaString)(e));return(0,k.V1)({subset:{chainId:Number(t.chainId.toString()),to:t.to??void 0,data:t.data},serializedTransaction:(0,rM.q5)(t.unsignedSerialized),type:t.type||0})}catch{return k.Cl}}};rB=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?rU(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&r$(t,r,i),i})([(0,N._G)()],rB);var rV=Object.defineProperty,rH=Object.getOwnPropertyDescriptor;let rW=class{_mappers;constructor(e){this._mappers=e}mapTransactionToSubset(e){for(let t of this._mappers){let r=t.map(e);if(r.isJust())return(0,k.xe)(r.extract())}return(0,k.MN)(Error("Unsupported transaction type"))}};rW=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?rH(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&rV(t,r,i),i})([(0,N._G)(),(y=(0,N.tt)(rc.TransactionMappers),(e,t)=>y(e,t,0))],rW);var rG=Object.defineProperty,rj=Object.getOwnPropertyDescriptor;let rX=class{extractValue(e,t){return k.uu.encase(()=>rF.Z.from((0,B.bufferToHexaString)(e))).chain(e=>t===tE.FROM?(0,k.MN)(Error("Cannot get 'FROM' field of an unsigned transaction")):t===tE.TO?k.bW.fromNullable(e.to).map(e=>(0,B.hexaStringToBuffer)(e)).filter(e=>null!==e).map(e=>[e]).toEither(Error("Faild to extract TO field of transaction")):t===tE.VALUE?k.bW.fromNullable(e.value).map(e=>new B.ByteArrayBuilder().add256BitUIntToData(e).build()).map(e=>[e]).toEither(Error("Faild to extract VALUE field of transaction")):k.bW.fromNullable(e.data).toEither(Error("Transaction calldata is empty")).chain(e=>k.bW.fromNullable((0,B.hexaStringToBuffer)(e)).toEither(Error(`Invalid hex string calldata: ${e}`))).chain(e=>this.extractCalldataValue(e,t)))}extractCalldataValue(e,t){return e=e.slice(4),0===t.length?(0,k.MN)(Error("Path is empty")):this.extractCalldataValueAt(e,t,0,0)}extractCalldataValueAt(e,t,r,a){let n=t[t.length-1],i=n.type===tC.SLICE?n:null;for(;t.length>0;){let n=t[0];switch(t=t.slice(1),n.type){case tC.TUPLE:a=r,r+=32*n.offset;break;case tC.ARRAY:return this.getU256(e.slice(r)).toEither(Error(`Invalid array length at offset ${r}`)).chain(i=>{r+=32,a=r;let s=void 0===n.start?0:n.start<0?i+n.start:n.start,o=void 0===n.end?i:n.end<0?i+n.end:n.end;return s<0||s>=i||o>i||s>=o?(0,k.MN)(Error(`Array slice out of bounds, start=${n.start}, end=${n.end}`)):Array.from({length:o-s},(e,t)=>t).map(e=>r+(e+s)*n.itemSize*32).reduce((r,n)=>r.chain(r=>this.extractCalldataValueAt(e,t,n,a).map(e=>[...r,...e])),(0,k.xe)([]))});case tC.REF:if(this.getU256(e.slice(r)).ifJust(e=>r=a+e).isNothing())return(0,k.MN)(Error(`Invalid ref at offset ${r}`));break;case tC.LEAF:switch(n.leafType){case tS.ARRAY_LEAF:return(0,k.MN)(Error("Array leaf is not supported in v1 of protocol"));case tS.TUPLE_LEAF:return(0,k.MN)(Error("Tuple leaf is not supported in v1 of protocol"));case tS.STATIC_LEAF:return this.getSlice(e,r,32).chain(e=>null===i?(0,k.xe)([e]):this.sliceLeaf(e,i));case tS.DYNAMIC_LEAF:return this.getU256(e.slice(r)).toEither(Error(`Invalid leaf length at offset ${r}`)).chain(t=>(r+=32,this.getSlice(e,r,t).chain(e=>null===i?(0,k.xe)([e]):this.sliceLeaf(e,i))))}break;case tC.SLICE:return(0,k.MN)(Error("Slice can only be used as last element of the path"))}}return(0,k.MN)(Error("Path did not resolve to a leaf element"))}sliceLeaf(e,t){let r=e.length,a=void 0===t.start?0:t.start<0?r+t.start:t.start,n=void 0===t.end?r:t.end<0?r+t.end:t.end;return a>=n?(0,k.MN)(Error(`invalid leaf slice: start ${a}, end ${n}`)):this.getSlice(e,a,n-a).map(e=>[e])}getSlice(e,t,r){return t<0||e.length<t+r?(0,k.MN)(Error(`calldata too small to slice at offset ${t} of length ${r}`)):(0,k.xe)(e.slice(t,t+r))}getU256(e){return k.bW.fromNullable(new B.ByteArrayParser(e).extract256BitUInt(!0)).filter(e=>e<=Number.MAX_SAFE_INTEGER).map(e=>Number(e))}};rX=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?rj(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&rG(t,r,i),i})([(0,N._G)()],rX);var rz=Object.defineProperty,rq=Object.getOwnPropertyDescriptor;let rY=class{_appBinding;constructor(e){this._appBinding=e}execute(e,t,r){return this._appBinding.signTransaction({derivationPath:e,transaction:t,options:r})}};rY=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?rq(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&rz(t,r,i),i})([(0,N._G)(),(E=(0,N.WQ)(tT.AppBinding),(e,t)=>E(e,t,0))],rY);let rK=()=>new N.i0((e,t,r,a,n,i,s)=>{e(rc.SignTransactionUseCase).to(rY),e(rc.TransactionMapperService).to(rW),e(rc.TransactionParserService).to(rX),e(rc.TransactionMappers).to(rB)}),rQ={SignTypedDataUseCase:Symbol.for("SignTypedDataUseCase"),TypedDataParserService:Symbol.for("TypedDataParserService")};class rJ{structs;constructor(e){let t={};for(let[r,a]of Object.entries(e)){let e={};for(let t of a)e[t.name]=this.parseType(t.type);t[r]=e}this.structs=t}getStructDefinitions(){return this.structs}parse(e,t){if(!this.isRecord(t))return(0,k.MN)(Error("Message is not a record"));let r=[{path:"",type:"",value:new tq(e)}];return this.visitValue(e,t,"",e=>r.push(e))?(0,k.xe)(r):(0,k.MN)(Error("Failed to parse"))}isRecord(e){return"object"==typeof e&&null!==e}parseType(e){return this.tryParsePrimitiveType(e).mapOrDefault(e=>e,this.tryParseArrayType(e).mapOrDefault(e=>e,new tz(e)))}tryParsePrimitiveType(e){{let t=e.match(/^(((u?)int)(\d+))$/);if(t){let e=parseInt(t[4]);return e%8!=0||0===e||e>256?k.Cl:(0,k.V1)(new tj(t[1],t[3]?"uint":"int",(0,k.V1)(e/8)))}}{let t=e.match(/^((bytes)(\d*))$/);if(t){let e=t[3]?parseInt(t[3]):null;return null!==e&&(0===e||e>32)?k.Cl:(0,k.V1)(new tj(t[1],"bytes",k.bW.fromNullable(e)))}}return"address"===e||"bool"===e||"string"===e?(0,k.V1)(new tj(e,e,k.Cl)):k.Cl}tryParseArrayType(e){let t=e.match(/^([^[[]*)(((\[\d*\])*)\[\d*\])$/);if(t){let r=[...t[2].matchAll(/\[(\d*)\]/g)];if(r&&r.length>0){let a=r.map(([,e])=>e?(0,k.V1)(parseInt(e)):k.Cl),n=this.tryParsePrimitiveType(t[1]).mapOrDefault(e=>e,new tz(t[1]));return(0,k.V1)(new tX(e,n,t[1]+t[3],a[a.length-1],a))}}return k.Cl}visitValue(e,t,r,a){return this.tryVisitStructValue(e,t,r,a)||this.tryVisitPrimitiveValue(e,t,r,a)||this.tryVisitArrayValue(e,t,r,a)}tryVisitPrimitiveValue(e,t,r,a){return!this.isRecord(t)&&!Array.isArray(t)&&this.tryParsePrimitiveType(e).chain(n=>(function(e,t){switch(e.name){case"string":return"string"!=typeof t?k.Cl:(0,k.V1)(new TextEncoder().encode(t));case"bytes":case"address":return"string"!=typeof t?k.Cl:function(e,t){let r="address"===e.name?(0,k.V1)(20):e.size;return k.bW.fromNullable((0,B.hexaStringToBuffer)(t)).filter(e=>r.mapOrDefault(t=>e.length<=t,!0))}(e,t);case"bool":case"uint":case"int":return"bool"===e.name&&"boolean"==typeof t&&(t=Number(t)),"string"!=typeof t&&"number"!=typeof t&&"bigint"!=typeof t?k.Cl:function(e,t,r){let a;switch(typeof r){case"bigint":a=r;break;case"number":if(!Number.isInteger(r))return k.Cl;a=BigInt(r);break;case"string":if(0===r.length)return k.Cl;try{a=BigInt(r)}catch{return k.Cl}}return(function(e,t,r){if(!r)return e>=0n&&e<1n<<t?(0,k.V1)(e):k.Cl;let a=1n<<t-1n;return e>=a||e<-a?k.Cl:(e<0n&&(e=(~(e=-e)&(1n<<t)-1n)+1n),(0,k.V1)(e))})(a,BigInt(t),"int"===e).chain(e=>k.bW.fromNullable((0,B.hexaStringToBuffer)(e.toString(16))))}(e.name,e.size.mapOrDefault(e=>8*e,1),t)}})(n,t).ifJust(t=>{a({path:r,type:e,value:new tK(t)})})).isJust()}tryVisitStructValue(e,t,r,a){let n=this.structs[e];if(void 0===n||!this.isRecord(t))return!1;for(let[e,i]of Object.entries(n)){let n=t[e];if(void 0===n)return!1;let s=r.length?`${r}.${e}`:e;if(!this.visitValue(i.typeName,n,`${s}`,a))return!1}return!0}tryVisitArrayValue(e,t,r,a){return Array.isArray(t)&&this.tryParseArrayType(e).filter(e=>e.count.mapOrDefault(e=>t.length==e,!0)).mapOrDefault(n=>{for(let i of(a({path:r,type:e,value:new tY(t.length)}),t)){let e=r.length?`${r}.[]`:"[]";if(!this.visitValue(n.rowType,i,`${e}`,a))return!1}return!0},!1)}}var rZ=Object.defineProperty,r0=Object.getOwnPropertyDescriptor;let r1=class{parse(e){let t=new rJ(e.types),r=t.getStructDefinitions(),a=t.parse("EIP712Domain",e.domain),n=t.parse(e.primaryType,e.message);return a.chain(e=>n.map(t=>({types:r,domain:e,message:t})))}};r1=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?r0(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&rZ(t,r,i),i})([(0,N._G)()],r1);var r2=Object.defineProperty,r3=Object.getOwnPropertyDescriptor,r4=(e,t)=>(r,a)=>t(r,a,e);let r8=class{_appBinding;_parser;constructor(e,t){this._appBinding=e,this._parser=t}execute(e,t){return this._appBinding.signTypedData({derivationPath:e,parser:this._parser,data:t})}};r8=((e,t,r,a)=>{for(var n,i=a>1?void 0:a?r3(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&r2(t,r,i),i})([(0,N._G)(),r4(0,(0,N.WQ)(tT.AppBinding)),r4(1,(0,N.WQ)(rQ.TypedDataParserService))],r8);let r5=()=>new N.i0((e,t,r,a,n,i,s)=>{e(rQ.SignTypedDataUseCase).to(r8),e(rQ.TypedDataParserService).to(r1)}),r6=({dmk:e,sessionId:t,contextModule:r})=>{let a=new N.mc;return a.bind(ro.Dmk).toConstantValue(e),a.bind(ro.ContextModule).toConstantValue(r),a.bind(ro.SessionId).toConstantValue(t),a.load(tx(),rD(),rk(),rK(),r5()),a};class r9{_container;constructor({dmk:e,sessionId:t,contextModule:r}){this._container=r6({dmk:e,sessionId:t,contextModule:r})}signTransaction(e,t,r){return this._container.get(rc.SignTransactionUseCase).execute(e,t,r)}signMessage(e,t){return this._container.get(rN.SignMessageUseCase).execute(e,t)}signTypedData(e,t){return this._container.get(rQ.SignTypedDataUseCase).execute(e,t)}getAddress(e,t){return this._container.get(tI.GetAddressUseCase).execute(e,t)}}class r7{_dmk;_sessionId;_contextModule;constructor({dmk:e,sessionId:t}){this._dmk=e,this._sessionId=t,this._contextModule=new ty().build()}withContextModule(e){return this._contextModule=e,this}build(){return new r9({dmk:this._dmk,sessionId:this._sessionId,contextModule:this._contextModule})}}},75163:()=>{},80055:()=>{},81919:e=>{let t=Object.freeze({loose:!0}),r=Object.freeze({});e.exports=e=>e?"object"!=typeof e?t:e:r},84923:(e,t,r)=>{let a=r(27148);e.exports=(e,t,r)=>{let n=new a(e,r),i=new a(t,r);return n.compare(i)||n.compareBuild(i)}},86105:function(e,t,r){var a,n,i,s,o;a=r(35596),r(29304),n=a.lib.WordArray,s=(i=a.algo).SHA256,o=i.SHA224=s.extend({_doReset:function(){this._hash=new n.init([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=4,e}}),a.SHA224=s._createHelper(o),a.HmacSHA224=s._createHmacHelper(o),e.exports=a.SHA224},86712:(e,t,r)=>{let{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=r(38538),s=r(69856),o=(t=e.exports={}).re=[],c=t.safeRe=[],l=t.src=[],d=t.t={},u=0,p="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[p,n]],f=e=>{for(let[t,r]of h)e=e.split(`${t}*`).join(`${t}{0,${r}}`).split(`${t}+`).join(`${t}{1,${r}}`);return e},g=(e,t,r)=>{let a=f(t),n=u++;s(e,n,t),d[e]=n,l[n]=t,o[n]=new RegExp(t,r?"g":void 0),c[n]=new RegExp(a,r?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${p}*`),g("MAINVERSION",`(${l[d.NUMERICIDENTIFIER]})\\.(${l[d.NUMERICIDENTIFIER]})\\.(${l[d.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${l[d.NUMERICIDENTIFIERLOOSE]})\\.(${l[d.NUMERICIDENTIFIERLOOSE]})\\.(${l[d.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${l[d.NUMERICIDENTIFIER]}|${l[d.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${l[d.NUMERICIDENTIFIERLOOSE]}|${l[d.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${l[d.PRERELEASEIDENTIFIER]}(?:\\.${l[d.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${l[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[d.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${p}+`),g("BUILD",`(?:\\+(${l[d.BUILDIDENTIFIER]}(?:\\.${l[d.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${l[d.MAINVERSION]}${l[d.PRERELEASE]}?${l[d.BUILD]}?`),g("FULL",`^${l[d.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${l[d.MAINVERSIONLOOSE]}${l[d.PRERELEASELOOSE]}?${l[d.BUILD]}?`),g("LOOSE",`^${l[d.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${l[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${l[d.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${l[d.XRANGEIDENTIFIER]})(?:\\.(${l[d.XRANGEIDENTIFIER]})(?:\\.(${l[d.XRANGEIDENTIFIER]})(?:${l[d.PRERELEASE]})?${l[d.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${l[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[d.XRANGEIDENTIFIERLOOSE]})(?:${l[d.PRERELEASELOOSE]})?${l[d.BUILD]}?)?)?`),g("XRANGE",`^${l[d.GTLT]}\\s*${l[d.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${l[d.GTLT]}\\s*${l[d.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),g("COERCE",`${l[d.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",l[d.COERCEPLAIN]+`(?:${l[d.PRERELEASE]})?`+`(?:${l[d.BUILD]})?`+"(?:$|[^\\d])"),g("COERCERTL",l[d.COERCE],!0),g("COERCERTLFULL",l[d.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${l[d.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${l[d.LONETILDE]}${l[d.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${l[d.LONETILDE]}${l[d.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${l[d.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${l[d.LONECARET]}${l[d.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${l[d.LONECARET]}${l[d.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${l[d.GTLT]}\\s*(${l[d.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${l[d.GTLT]}\\s*(${l[d.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${l[d.GTLT]}\\s*(${l[d.LOOSEPLAIN]}|${l[d.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${l[d.XRANGEPLAIN]})\\s+-\\s+(${l[d.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${l[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[d.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")},88762:()=>{},91524:(e,t,r)=>{let a=r(98033);e.exports=(e,t,r)=>{try{t=new a(t,r)}catch(e){return!1}return t.test(e)}},91678:(e,t,r)=>{let a=r(27148);e.exports=(e,t,r=!1)=>{if(e instanceof a)return e;try{return new a(e,t)}catch(e){if(!r)return null;throw e}}},94955:(e,t,r)=>{let a=r(91678);e.exports=(e,t)=>{let r=a(e,t);return r?r.version:null}},97717:()=>{},98033:(e,t,r)=>{let a=/\s+/g;class n{constructor(e,t){if(t=s(t),e instanceof n){if(!!t.loose===e.loose&&!!t.includePrerelease===e.includePrerelease)return e;return new n(e.raw,t)}if(e instanceof o)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(a," "),this.set=this.raw.split("||").map(e=>this.parseRange(e.trim())).filter(e=>e.length),!this.set.length)throw TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let e=this.set[0];if(this.set=this.set.filter(e=>!y(e[0])),0===this.set.length)this.set=[e];else if(this.set.length>1){for(let e of this.set)if(1===e.length&&E(e[0])){this.set=[e];break}}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let t=((this.options.includePrerelease&&g)|(this.options.loose&&m))+":"+e,r=i.get(t);if(r)return r;let a=this.options.loose,n=a?d[u.HYPHENRANGELOOSE]:d[u.HYPHENRANGE];c("hyphen replace",e=e.replace(n,D(this.options.includePrerelease))),c("comparator trim",e=e.replace(d[u.COMPARATORTRIM],p)),c("tilde trim",e=e.replace(d[u.TILDETRIM],h)),c("caret trim",e=e.replace(d[u.CARETTRIM],f));let s=e.split(" ").map(e=>S(e,this.options)).join(" ").split(/\s+/).map(e=>b(e,this.options));a&&(s=s.filter(e=>(c("loose invalid filter",e,this.options),!!e.match(d[u.COMPARATORLOOSE])))),c("range list",s);let l=new Map;for(let e of s.map(e=>new o(e,this.options))){if(y(e))return[e];l.set(e.value,e)}l.size>1&&l.has("")&&l.delete("");let E=[...l.values()];return i.set(t,E),E}intersects(e,t){if(!(e instanceof n))throw TypeError("a Range is required");return this.set.some(r=>C(r,t)&&e.set.some(e=>C(e,t)&&r.every(r=>e.every(e=>r.intersects(e,t)))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new l(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(N(this.set[t],e,this.options))return!0;return!1}}e.exports=n;let i=new(r(27224)),s=r(81919),o=r(15076),c=r(69856),l=r(27148),{safeRe:d,t:u,comparatorTrimReplace:p,tildeTrimReplace:h,caretTrimReplace:f}=r(86712),{FLAG_INCLUDE_PRERELEASE:g,FLAG_LOOSE:m}=r(38538),y=e=>"<0.0.0-0"===e.value,E=e=>""===e.value,C=(e,t)=>{let r=!0,a=e.slice(),n=a.pop();for(;r&&a.length;)r=a.every(e=>n.intersects(e,t)),n=a.pop();return r},S=(e,t)=>(c("comp",e,t),c("caret",e=A(e,t)),c("tildes",e=T(e,t)),c("xrange",e=x(e,t)),c("stars",e=w(e,t)),e),I=e=>!e||"x"===e.toLowerCase()||"*"===e,T=(e,t)=>e.trim().split(/\s+/).map(e=>v(e,t)).join(" "),v=(e,t)=>{let r=t.loose?d[u.TILDELOOSE]:d[u.TILDE];return e.replace(r,(t,r,a,n,i)=>{let s;return c("tilde",e,t,r,a,n,i),I(r)?s="":I(a)?s=`>=${r}.0.0 <${+r+1}.0.0-0`:I(n)?s=`>=${r}.${a}.0 <${r}.${+a+1}.0-0`:i?(c("replaceTilde pr",i),s=`>=${r}.${a}.${n}-${i} <${r}.${+a+1}.0-0`):s=`>=${r}.${a}.${n} <${r}.${+a+1}.0-0`,c("tilde return",s),s})},A=(e,t)=>e.trim().split(/\s+/).map(e=>_(e,t)).join(" "),_=(e,t)=>{c("caret",e,t);let r=t.loose?d[u.CARETLOOSE]:d[u.CARET],a=t.includePrerelease?"-0":"";return e.replace(r,(t,r,n,i,s)=>{let o;return c("caret",e,t,r,n,i,s),I(r)?o="":I(n)?o=`>=${r}.0.0${a} <${+r+1}.0.0-0`:I(i)?o="0"===r?`>=${r}.${n}.0${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.0${a} <${+r+1}.0.0-0`:s?(c("replaceCaret pr",s),o="0"===r?"0"===n?`>=${r}.${n}.${i}-${s} <${r}.${n}.${+i+1}-0`:`>=${r}.${n}.${i}-${s} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${i}-${s} <${+r+1}.0.0-0`):(c("no pr"),o="0"===r?"0"===n?`>=${r}.${n}.${i}${a} <${r}.${n}.${+i+1}-0`:`>=${r}.${n}.${i}${a} <${r}.${+n+1}.0-0`:`>=${r}.${n}.${i} <${+r+1}.0.0-0`),c("caret return",o),o})},x=(e,t)=>(c("replaceXRanges",e,t),e.split(/\s+/).map(e=>R(e,t)).join(" ")),R=(e,t)=>{e=e.trim();let r=t.loose?d[u.XRANGELOOSE]:d[u.XRANGE];return e.replace(r,(r,a,n,i,s,o)=>{c("xRange",e,r,a,n,i,s,o);let l=I(n),d=l||I(i),u=d||I(s);return"="===a&&u&&(a=""),o=t.includePrerelease?"-0":"",l?r=">"===a||"<"===a?"<0.0.0-0":"*":a&&u?(d&&(i=0),s=0,">"===a?(a=">=",d?(n=+n+1,i=0):i=+i+1,s=0):"<="===a&&(a="<",d?n=+n+1:i=+i+1),"<"===a&&(o="-0"),r=`${a+n}.${i}.${s}${o}`):d?r=`>=${n}.0.0${o} <${+n+1}.0.0-0`:u&&(r=`>=${n}.${i}.0${o} <${n}.${+i+1}.0-0`),c("xRange return",r),r})},w=(e,t)=>(c("replaceStars",e,t),e.trim().replace(d[u.STAR],"")),b=(e,t)=>(c("replaceGTE0",e,t),e.trim().replace(d[t.includePrerelease?u.GTE0PRE:u.GTE0],"")),D=e=>(t,r,a,n,i,s,o,c,l,d,u,p)=>(r=I(a)?"":I(n)?`>=${a}.0.0${e?"-0":""}`:I(i)?`>=${a}.${n}.0${e?"-0":""}`:s?`>=${r}`:`>=${r}${e?"-0":""}`,c=I(l)?"":I(d)?`<${+l+1}.0.0-0`:I(u)?`<${l}.${+d+1}.0-0`:p?`<=${l}.${d}.${u}-${p}`:e?`<${l}.${d}.${+u+1}-0`:`<=${c}`,`${r} ${c}`.trim()),N=(e,t,r)=>{for(let r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++)if(c(e[r].semver),e[r].semver!==o.ANY&&e[r].semver.prerelease.length>0){let a=e[r].semver;if(a.major===t.major&&a.minor===t.minor&&a.patch===t.patch)return!0}return!1}return!0}},99201:()=>{},99406:(e,t,r)=>{let a=r(46006);e.exports=(e,t,r)=>a(t,e,r)}}]);
//# sourceMappingURL=9331.51a1857625c83913.js.map